<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShutterSync CRM</title>
    <!-- Corrected path for style.css -->
    <link rel="stylesheet" href="css/style.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Grid.js CSS -->
    <link href="https://unpkg.com/gridjs/6.2.0/dist/theme/mermaid.min.css" rel="stylesheet" />

</head>
<body>
    <!-- The overall container wrapping everything -->
    <div class="container">
        <!-- Sidebar content, based on your CSS -->
        <aside class="sidebar">
            <div>
                <div class="logo">ShutterSync CRM</div>
                <nav class="main-nav">
                    <button class="nav-button active" data-module="dashboard">Dashboard</button>
                    <button class="nav-button" data-module="customers">Customers</button>
                    <button class="nav-button" data-module="opportunities">Opportunities</button>
                    <button class="nav-button admin-only" data-module="admin">Admin</button>
                </nav>
            </div>
            <div class="user-info" id="userInfoDisplay">
                <div class="user-details">
                    Welcome, <span id="userName"></span> (<span id="userRole"></span>)
                </div>
                <button id="authButton" class="auth-button sign-out">Sign Out</button>
            </div>
            <!-- Auth button for when signed out, positioned correctly by flexbox in sidebar -->
            <button id="authButtonAnon" class="auth-button sign-in" style="display:none;">Sign In with Google</button>
        </aside>

        <!-- Main content area -->
        <main class="content-area">
            <!-- Dashboard Module -->
            <section id="dashboardModule" class="module active">
                <h2>Dashboard</h2>
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <h3>Total Customers</h3>
                        <p id="totalCustomersCount">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Total Opportunities</h3>
                        <p id="totalOpportunitiesCount">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Open Opportunities</h3>
                        <p id="openOpportunitiesCount">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Won Opportunities</h3>
                        <p id="wonOpportunitiesCount">0</p>
                    </div>
                </div>
            </section>

            <!-- Customers Module -->
            <section id="customersModule" class="module">
                <h2>Customers</h2>
                <button id="addCustomerBtn" class="add-button">Add New Customer</button>
                <div id="customersTable"></div> <!-- This will be the Grid.js container -->
            </section>

            <!-- Opportunities Module -->
            <section id="opportunitiesModule" class="module">
                <h2>Opportunities</h2>
                <button id="addOpportunityBtn" class="add-button">Add New Opportunity</button>
                <div id="opportunitiesTable"></div> <!-- This will be the Grid.js container -->
            </section>

            <!-- Admin Module -->
            <section id="adminModule" class="module admin-only">
                <h2>Admin Panel</h2>
                <div class="admin-nav">
                    <button class="admin-section-btn active" data-admin-target="countriesStates">Countries & States</button>
                    <button class="admin-section-btn" data-admin-target="currencies">Currencies</button>
                    <button class="admin-section-btn" data-admin-target="priceBooks">Price Books</button>
                    <button class="admin-section-btn" data-admin-target="settings">App Settings</button>
                </div>

                <div id="countriesStatesSection" class="admin-subsection active">
                    <h3>Manage Countries & States</h3>
                    <form id="countryStateForm" class="admin-form">
                        <input type="hidden" id="countryStateId">
                        <label for="countryName">Country Name:</label>
                        <input type="text" id="countryName" required>
                        <label for="countryCode">Country Code:</label>
                        <input type="text" id="countryCode" maxlength="2" required>
                        <label for="countryStates">States (comma-separated):</label>
                        <input type="text" id="countryStates">
                        <button type="submit" class="save-button">Save Country</button>
                        <button type="button" class="cancel-edit-btn">Cancel</button>
                    </form>
                    <div id="countriesStatesTable"></div> <!-- This will be the Grid.js container -->
                </div>

                <div id="currenciesSection" class="admin-subsection">
                    <h3>Manage Currencies</h3>
                    <form id="currencyForm" class="admin-form">
                        <input type="hidden" id="currencyId">
                        <label for="currencyName">Currency Name:</label>
                        <input type="text" id="currencyName" required>
                        <label for="currencySymbol">Symbol:</label>
                        <input type="text" id="currencySymbol" maxlength="5" required>
                        <button type="submit" class="save-button">Save Currency</button>
                        <button type="button" class="cancel-edit-btn">Cancel</button>
                    </form>
                    <div id="currenciesTable"></div> <!-- This will be the Grid.js container -->
                </div>

                <div id="priceBooksSection" class="admin-subsection">
                    <h3>Manage Price Books</h3>
                    <form id="priceBookForm" class="admin-form">
                        <input type="hidden" id="priceBookId">
                        <label for="priceBookName">Price Book Name:</label>
                        <input type="text" id="priceBookName" required>
                        <label for="priceBookDescription">Description:</label>
                        <textarea id="priceBookDescription"></textarea>
                        <label for="priceBookCurrency">Currency:</label> <!-- New field -->
                        <select id="priceBookCurrency"></select> <!-- New field -->
                        <button type="submit" class="save-button">Save Price Book</button>
                        <button type="button" class="cancel-edit-btn">Cancel</button>
                    </form>
                    <div id="priceBooksTable"></div> <!-- This will be the Grid.js container -->
                </div>

                <div id="settingsSection" class="admin-subsection">
                    <h3>App Settings</h3>
                    <form id="appSettingsForm" class="admin-form">
                        <input type="hidden" id="settingsDocId">
                        <label for="defaultCurrency">Default Currency:</label>
                        <select id="defaultCurrency"></select> <!-- Populate from currencies -->
                        <label for="defaultCountry">Default Country:</label>
                        <select id="defaultCountry"></select> <!-- Populate from countries -->
                        <button type="submit" class="save-button">Save Settings</button>
                        <button type="button" class="cancel-edit-btn">Cancel</button>
                    </form>
                </div>
            </section>
        </main>
    </div>

    <!-- Customer Modal -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 id="customerModalTitle">Add/Edit Customer</h3>
            <form id="customerForm">
                <input type="hidden" id="customerId">
                <label for="customerType">Customer Type:</label>
                <select id="customerType" required>
                    <option value="Individual">Individual</option>
                    <option value="Company">Company</option>
                </select>
                <label for="customerName">Name:</label>
                <input type="text" id="customerName" required>
                <label for="customerEmail">Email:</label>
                <input type="email" id="customerEmail">
                <label for="customerPhone">Phone:</label>
                <input type="tel" id="customerPhone">
                <label for="customerAddress">Address:</label>
                <textarea id="customerAddress" rows="3"></textarea> <!-- Changed to textarea -->
                <label for="customerCountry">Country:</label>
                <select id="customerCountry"></select>
                <label for="customerPreferredContactMethod">Preferred Contact Method:</label>
                <select id="customerPreferredContactMethod">
                    <option value="Email">Email</option>
                    <option value="Phone">Phone</option>
                    <option value="Mail">Mail</option>
                </select>
                <label for="customerIndustry">Industry:</label>
                <select id="customerIndustry"> <!-- Changed to select dropdown -->
                    <option value="">Select Industry</option>
                    <option value="Technology">Technology</option>
                    <option value="Finance">Finance</option>
                    <option value="Healthcare">Healthcare</option>
                    <option value="Other">Other</option>
                </select>
                <label for="customerAdditionalDetails">Additional Details:</label>
                <textarea id="customerAdditionalDetails"></textarea>
                <label for="customerSource">Source:</label>
                <select id="customerSource"> <!-- Changed to select dropdown -->
                    <option value="">Select Source</option>
                    <option value="Website">Website</option>
                    <option value="Referral">Referral</option>
                    <option value="Social Media">Social Media</option>
                    <option value="Advertisement">Advertisement</option>
                    <option value="Event">Event</option>
                    <option value="Others">Others</option>
                </select>
                <label for="customerActive">Active:</label>
                <select id="customerActive">
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
                <button type="submit">Save Customer</button>
            </form>
        </div>
    </div>

    <!-- Opportunity Modal -->
    <div id="opportunityModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 id="opportunityModalTitle">Add/Edit Opportunity</h3>
            <form id="opportunityForm">
                <input type="hidden" id="opportunityId">
                <label for="opportunityName">Opportunity Name:</label>
                <input type="text" id="opportunityName" required>
                <label for="opportunityCustomer">Customer:</label>
                <select id="opportunityCustomer" required></select>
                <label for="opportunityCurrency">Currency:</label>
                <select id="opportunityCurrency"></select>
                <label for="opportunityPriceBook">Price Book:</label>
                <select id="opportunityPriceBook"></select>
                <label for="opportunityExpectedStartDate">Expected Start Date:</label>
                <input type="date" id="opportunityExpectedStartDate">
                <label for="opportunityExpectedCloseDate">Expected Close Date:</label>
                <input type="date" id="opportunityExpectedCloseDate">
                <label for="opportunitySalesStage">Sales Stage:</label>
                <select id="opportunitySalesStage">
                    <option value="Prospect">Prospect</option>
                    <option value="Qualified">Qualified</option>
                    <option value="Proposal">Proposal</option>
                    <option value="Negotiation">Negotiation</option>
                    <option value="Won">Won</option>
                    <option value="Lost">Lost</option>
                </select>
                <label for="opportunityProbability">Probability (%):</label>
                <input type="number" id="opportunityProbability" min="0" max="100" step="1">
                <label for="opportunityValue">Value:</label>
                <input type="number" id="opportunityValue" min="0">
                <label for="opportunityNotes">Notes:</label>
                <textarea id="opportunityNotes"></textarea>
                <button type="submit">Save Opportunity</button>
            </form>
        </div>
    </div>


    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js"></script>

    <!-- Grid.js JS -->
    <script src="https://unpkg.com/gridjs/6.2.0/dist/gridjs.umd.js"></script>
    
    <!-- Your main application script with corrected path -->
    <script src="js/script.js"></script>
</body>
</html>
