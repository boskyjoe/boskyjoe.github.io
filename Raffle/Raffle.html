<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>St. Sebastian's Church Raffle Winner Announcement</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #f0f4ff, #dbe9ff);
    color: #1a202c;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  main {
    flex-grow: 1;
    padding: 1rem 1.5rem 2rem;
    max-width: 900px;
    margin: 0 auto;
    width: 100%;
  }
  /* Header */
  header {
    background: #1755a5;
    color: white;
    padding: 1rem 1.5rem;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    border-bottom: 4px solid #0f3f73;
  }
  header img.logo {
    height: 90px;
    width: auto;
    flex-shrink: 0;
  }
  header .header-content {
    text-align: center;
    flex-grow: 1;
    min-width: 250px;
  }
  header h1 {
    font-weight: 700;
    font-size: 1.8rem;
    margin: 0 0 0.25rem;
    line-height: 1.2;
  }
  header .address-contact {
    font-weight: 500;
    font-size: 0.9rem;
    opacity: 0.85;
    user-select: text;
  }

  /* Cards container */
  section.draw-cards {
    margin-top: 2rem;
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  /* Each winner card */
  .winner-card {
    background: white;
    box-shadow: 0 10px 25px rgba(30,30,30,0.1);
    border-radius: 15px;
    flex: 1 1 280px;
    max-width: 280px;
    display: flex;
    flex-direction: column;
    padding: 1rem 1.5rem 2rem;
    position: relative;
    overflow: hidden;
  }

  .winner-place {
    font-weight: 700;
    font-size: 1.3rem;
    color: #1755a5;
    text-align: center;
    user-select: none;
  }

  .number-display {
    margin: 1.5rem 0 1.3rem;
    font-size: 3.6rem;
    font-weight: 800;
    color: #0b2f64;
    user-select: none;
    text-align: center;
    height: 4.5rem;
    line-height: 4.5rem;
    font-family: 'Courier New', Courier, monospace;
    letter-spacing: 0.25rem;
    border-radius: 7px;
    background: linear-gradient(90deg, #e9f1fd, #d0e0fd);
    box-shadow: inset 0 3px 7px rgba(0,0,0,0.05);
  }

  /* Spin animation for numbers */
  .number-spin {
    animation: spinNumbers 0.15s linear infinite;
  }
  @keyframes spinNumbers {
    0% { color: #1764a5; }
    50% { color: #0b2f64; }
    100% { color: #1764a5; }
  }

  /* Button style */
  button.draw-btn,
  button.reset-btn {
    padding: 0.5rem 1.25rem;
    font-weight: 700;
    font-size: 1rem;
    color: white;
    border-radius: 50px;
    border: none;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s ease;
    box-shadow: 0 6px 12px rgba(23, 85, 165, 0.5);
  }
  button.draw-btn {
    background-color: #2962ff;
  }
  button.draw-btn:hover:not(:disabled) {
    background-color: #0039cb;
  }
  button.draw-btn:disabled {
    background-color: #a4bffb;
    cursor: not-allowed;
    box-shadow: none;
  }
  button.reset-btn {
    background-color: #f44336;
    width: 100%;
    margin-top: 1.8rem;
    box-shadow: 0 6px 12px rgba(244, 67, 54, 0.5);
    font-size: 1.1rem;
  }
  button.reset-btn:hover {
    background-color: #ba000d;
  }

  /* Responsive text adjustment */
  @media (max-width: 480px) {
    header h1 {
      font-size: 1.3rem;
    }
    header .address-contact {
      font-size: 0.8rem;
    }
    .winner-place {
      font-size: 1.1rem;
    }
    .number-display {
      font-size: 3rem;
      height: 4rem;
      line-height: 3.8rem;
    }
  }
</style>
</head>
<body>
<header>
  <img src="https://static.wixstatic.com/media/df2113_f71b21a1906c4d2bace3f797f5a6a8bb~mv2.png/v1/crop/x_5,y_0,w_365,h_315/fill/w_174,h_150,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/LogoDesign-II%20(1)_edited.png" alt="St. Sebastian's Church Logo" class="logo" />
  <div class="header-content">
    <h1>St. Sebastian's Church Raffle Winner Announcement</h1>
    <div class="address-contact">
      No:184/C, New Byppanahalli Extn, Indiranagar, Bengaluru â€“ 560038<br />
      +91 7090424365 | stsebastianssmc@gmail.com
    </div>
  </div>
</header>
<main>
  <section class="draw-cards">
    <!-- 3rd Place -->
    <article class="winner-card" id="card-third" aria-label="Third place winner card">
      <div class="winner-place">3rd Place Winner</div>
      <div class="number-display" id="number-third" aria-live="polite" aria-atomic="true" aria-relevant="additions">---</div>
      <button class="draw-btn" id="btn-third" aria-describedby="desc-third">Draw 3rd Place</button>
      <p id="desc-third" class="visually-hidden">Click to draw the third place winner</p>
    </article>
    <!-- 2nd Place (hidden initially) -->
    <article class="winner-card" id="card-second" aria-label="Second place winner card" style="display:none;">
      <div class="winner-place">2nd Place Winner</div>
      <div class="number-display" id="number-second" aria-live="polite" aria-atomic="true" aria-relevant="additions">---</div>
      <button class="draw-btn" id="btn-second" aria-describedby="desc-second">Draw 2nd Place</button>
      <p id="desc-second" class="visually-hidden">Click to draw the second place winner</p>
    </article>
    <!-- 1st Place (hidden initially) -->
    <article class="winner-card" id="card-first" aria-label="First place winner card" style="display:none;">
      <div class="winner-place">1st Place Winner</div>
      <div class="number-display" id="number-first" aria-live="polite" aria-atomic="true" aria-relevant="additions">---</div>
      <button class="draw-btn" id="btn-first" aria-describedby="desc-first">Draw 1st Place</button>
      <p id="desc-first" class="visually-hidden">Click to draw the first place winner</p>
    </article>
  </section>
  <button class="reset-btn" id="btn-reset" aria-label="Reset the raffle draw" disabled>Reset Draw</button>
</main>

<!-- Accessibility helper -->
<style>
  .visually-hidden { 
    position: absolute !important;
    width: 1px !important; 
    height: 1px !important; 
    padding: 0 !important; 
    margin: -1px !important; 
    overflow: hidden !important; 
    clip: rect(0, 0, 0, 0) !important; 
    white-space: nowrap !important; 
    border: 0 !important;
  }
</style>

<script>
(() => {
  "use strict";

  // Elements references
  const btnThird = document.getElementById("btn-third");
  const btnSecond = document.getElementById("btn-second");
  const btnFirst = document.getElementById("btn-first");
  const btnReset = document.getElementById("btn-reset");
  
  const cardSecond = document.getElementById("card-second");
  const cardFirst = document.getElementById("card-first");
  
  const numberThird = document.getElementById("number-third");
  const numberSecond = document.getElementById("number-second");
  const numberFirst = document.getElementById("number-first");
  
  // Winners.txt file URL (same origin or CORS enabled)
  const winnersFile = "Winners.txt";

  // State
  let possibleWinners = []; // all possible winner numbers (string)
  let winnersPicked = new Set();

  // Spin animation config
  const spinDurationMs = 4000; // how long does the spinning last
  const spinIntervalMs = 50;    // interval between number changes during spin

  /**
   * Fetch possible winner numbers from Winners.txt.
   * Assumes format: one number per line.
   * Returns Promise<string[]> of trimmed non-empty lines.
   */
  async function loadPossibleWinners() {
    try {
      const resp = await fetch(winnersFile, {cache: "no-store"});
      if (!resp.ok) throw new Error(`Failed to load winners list: ${resp.status}`);
      const text = await resp.text();
      // Parsing: split lines, trim, ignore empty lines
      const lines = text.split(/\r?\n/).map(l => l.trim()).filter(l => l.length > 0);
      if (lines.length < 3) throw new Error("Winners.txt must contain at least 3 entries.");
      return lines;
    } catch (err) {
      alert("Error loading winners list:\n" + err.message + "\nPlease ensure Winners.txt is accessible.");
      throw err;
    }
  }

  /**
   * Returns a random number from possibleWinners not already picked
   */
  function getRandomWinner() {
    // Filter out already picked
    const available = possibleWinners.filter(n => !winnersPicked.has(n));
    if (available.length === 0) return null;
    const idx = Math.floor(Math.random() * available.length);
    return available[idx];
  }

  /**
   * Animate spinning numbers on given display element, then resolve with selected winner
   * @param {HTMLElement} displayEl 
   * @returns {Promise<string>} winner number
   */
  function spinAndPick(displayEl) {
    return new Promise((resolve) => {
      let spinTimeElapsed = 0;
      displayEl.classList.add("number-spin");

      // Change number very fast from possibleWinners randomly
      const intervalId = setInterval(() => {
        const randomNum = possibleWinners[Math.floor(Math.random() * possibleWinners.length)];
        displayEl.textContent = randomNum;
      }, spinIntervalMs);

      // Stop after spinDurationMs
      setTimeout(() => {
        clearInterval(intervalId);
        displayEl.classList.remove("number-spin");

        // Pick final number
        let winner = null;
        do {
          winner = getRandomWinner();
        } while (winner === null && possibleWinners.length > 0);

        if (winner === null) {
          // fallback if no available winner
          winner = "---";
        }
        displayEl.textContent = winner;
        resolve(winner);
      }, spinDurationMs);
    });
  }

  /**
   * Reset the whole UI and state to fresh state
   */
  function resetDraw() {
    winnersPicked.clear();
    numberThird.textContent = "---";
    numberSecond.textContent = "---";
    numberFirst.textContent = "---";

    // Show only 3rd place card + enable its button
    cardSecond.style.display = "none";
    cardFirst.style.display = "none";

    btnThird.disabled = false;
    btnSecond.disabled = true;
    btnFirst.disabled = true;
    btnReset.disabled = true;
  }

  /**
   * Initialize listeners and load winners list
   */
  async function init() {
    possibleWinners = await loadPossibleWinners();

    // Initial UI state
    resetDraw();

    // 3rd place draw button handler
    btnThird.addEventListener("click", async () => {
      btnThird.disabled = true;
      const winner3 = await spinAndPick(numberThird);
      winnersPicked.add(winner3);
      // Show second place card, enable second draw button
      cardSecond.style.display = "flex";
      btnSecond.disabled = false;
    });

    // 2nd place draw button handler
    btnSecond.addEventListener("click", async () => {
      btnSecond.disabled = true;
      const winner2 = await spinAndPick(numberSecond);
      winnersPicked.add(winner2);
      // Show first place card, enable first draw button
      cardFirst.style.display = "flex";
      btnFirst.disabled = false;
    });

    // 1st place draw button handler
    btnFirst.addEventListener("click", async () => {
      btnFirst.disabled = true;
      const winner1 = await spinAndPick(numberFirst);
      winnersPicked.add(winner1);
      // All done, enable reset button
      btnReset.disabled = false;
    });

    // Reset button handler
    btnReset.addEventListener("click", () => {
      resetDraw();
    });
  }

  // Kick off init on DOM ready
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", init);
  } else {
    init();
  }
})();
</script>
</body>
</html>
