<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Raffle Winner Picker</title>
  <style>
    /* Reset and basic styles */
    * {
      box-sizing: border-box;
    }
    body, html {
      margin: 0; padding: 0;
      height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      text-align: center;
      padding: 20px;
      user-select: none;
    }

    h1 {
      font-size: clamp(2rem, 5vw, 3rem);
      margin-bottom: 10px;
      letter-spacing: 2px;
      text-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    p.description {
      font-size: clamp(1rem, 2vw, 1.25rem);
      margin-bottom: 40px;
      color: #d1c4e9;
    }

    .raffle-container {
      width: 100%;
      max-width: 450px;
      background: rgba(255,255,255,0.1);
      border-radius: 20px;
      padding: 30px 25px;
      box-shadow:
        0 8px 20px rgba(0,0,0,0.25);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .winner-block {
      background: linear-gradient(135deg, #ff9a9e, #fad0c4);
      margin-bottom: 25px;
      border-radius: 15px;
      padding: 20px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: 0 4px 15px rgba(255,105,180,0.5);
      position: relative;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    .winner-block:hover:not(.disabled) {
      transform: scale(1.05);
      box-shadow: 0 8px 30px rgba(255,105,180,0.8);
    }
    .winner-block.disabled {
      filter: brightness(0.6);
      cursor: default;
      pointer-events: none;
      box-shadow: none;
    }
    .winner-place {
      font-weight: 700;
      font-size: clamp(1.25rem, 3vw, 1.8rem);
      margin-bottom: 8px;
      color: #6a1b9a;
      letter-spacing: 0.1em;
      text-shadow: 0 2px 6px rgba(255,255,255,0.7);
    }
    .winner-number {
      font-size: clamp(2.5rem, 6vw, 4rem);
      font-weight: 900;
      letter-spacing: 0.2em;
      color: #4a148c;
      min-height: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: text;
      position: relative;
    }
    /* Animated number rolling effect */
    .rolling {
      animation: rollingAnimation 1.2s linear infinite;
      background: linear-gradient(45deg, #7b1fa2 25%, #e91e63 50%, #7b1fa2 75%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;
      font-weight: 900;
      font-variant-numeric: tabular-nums;
    }

    @keyframes rollingAnimation {
      0% {
        background-position: 0% 50%;
      }
      100% {
        background-position: 200% 50%;
      }
    }

    button.generate-btn {
      margin-top: 15px;
      background: #9575cd;
      border: none;
      padding: 12px 25px;
      border-radius: 30px;
      color: white;
      font-weight: 600;
      font-size: clamp(1rem, 2vw, 1.15rem);
      letter-spacing: 0.05em;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(149, 117, 205, 0.6);
      transition: background 0.3s ease, box-shadow 0.3s ease;
      outline-offset: 4px;
    }
    button.generate-btn:hover:not(:disabled) {
      background: #5e35b1;
      box-shadow: 0 8px 20px rgba(94, 53, 177, 0.85);
    }
    button.generate-btn:disabled {
      background: #b39ddb;
      cursor: not-allowed;
      box-shadow: none;
    }

    @media (max-width: 500px) {
      .raffle-container {
        padding: 25px 15px;
      }
      .winner-number {
        font-size: clamp(2rem, 8vw, 3rem);
      }
    }
  </style>
</head>
<body>
  <h1>ðŸŽ‰ Raffle Winner Picker ðŸŽ‰</h1>
  <p class="description">Click each button to draw the 3rd, 2nd and 1st winner in order.<br />
  Numbers are loaded from <code>Winners.txt</code>.</p>
  <div class="raffle-container" role="main" aria-label="Raffle winner picker">

    <section class="winner-block" id="third-block" tabindex="0" aria-labelledby="third-label" aria-live="polite">
      <div class="winner-place" id="third-label">3rd Place</div>
      <div class="winner-number" id="third-number">---</div>
      <button class="generate-btn" id="third-btn" aria-describedby="third-label">Pick 3rd Winner</button>
    </section>

    <section class="winner-block" id="second-block" tabindex="0" aria-labelledby="second-label" aria-live="polite">
      <div class="winner-place" id="second-label">2nd Place</div>
      <div class="winner-number" id="second-number">---</div>
      <button class="generate-btn" id="second-btn" aria-describedby="second-label" disabled>Pick 2nd Winner</button>
    </section>

    <section class="winner-block" id="first-block" tabindex="0" aria-labelledby="first-label" aria-live="polite">
      <div class="winner-place" id="first-label">1st Place</div>
      <div class="winner-number" id="first-number">---</div>
      <button class="generate-btn" id="first-btn" aria-describedby="first-label" disabled>Pick 1st Winner</button>
    </section>

  </div>

  <script>
    /*
      Raffle Winner Picker Script
      Loads numbers from Winners.txt, initializes internal data,
      enables picking winners for 3rd, 2nd, 1st in order.
      Includes animated rolling effect while picking.
    */

    (function () {
      // DOM Elements
      const thirdBtn = document.getElementById('third-btn');
      const secondBtn = document.getElementById('second-btn');
      const firstBtn = document.getElementById('first-btn');

      const thirdNumber = document.getElementById('third-number');
      const secondNumber = document.getElementById('second-number');
      const firstNumber = document.getElementById('first-number');

      const thirdBlock = document.getElementById('third-block');
      const secondBlock = document.getElementById('second-block');
      const firstBlock = document.getElementById('first-block');

      let possibleWinners = [];
      let pickedWinners = [];

      /**
       * Fetch the numbers from Winners.txt
       * Expecting one number per line, trimmed.
       * Returns array of strings.
       */
      async function fetchWinnersFile() {
        try {
          const response = await fetch('Winners.txt', {cache: "no-store"});
          if (!response.ok) {
            throw new Error('Failed to load Winners.txt');
          }
          const text = await response.text();
          // Parse text lines
          const lines = text.split(/\r?\n/).map(line => line.trim()).filter(line => line.length > 0);
          // Validate numbers: Only digits allowed (but can be alphanumeric depending on data)
          return lines;
        } catch (error) {
          alert('Error loading Winners.txt file: ' + error.message + '\nMake sure the file exists and is accessible.');
          return [];
        }
      }

      /**
       * Generate a random index based on current possible winners
       */
      function randomIndex(max) {
        return Math.floor(Math.random() * max);
      }

      /**
       * Animate rolling numbers for a given element for a duration, then resolve with chosen winner
       * @param {HTMLElement} element - element to show rolling animation
       * @param {Array<string>} pool - array of possible winners to pick randomly from
       * @param {number} duration - duration of rolling in ms
       * @returns {Promise<string>} resolved with selected winner
       */
      function rollAnimation(element, pool, duration = 2000) {
        return new Promise((resolve) => {
          let animationInterval;
          const intervalTime = 70; // Change display every 70ms (fast rolling)

          // Helper: show random number with rolling class for effect
          function showRandomNumber() {
            const randNum = pool[randomIndex(pool.length)];
            element.textContent = randNum;
            element.classList.add('rolling');
          }

          showRandomNumber();
          animationInterval = setInterval(showRandomNumber, intervalTime);

          setTimeout(() => {
            clearInterval(animationInterval);
            // Pick final winner
            const winnerIndex = randomIndex(pool.length);
            const winner = pool[winnerIndex];
            element.textContent = winner;
            element.classList.remove('rolling');
            resolve(winner);
          }, duration);
        });
      }

      /**
       * Disable a button and visually disable the containing block
       * @param {HTMLElement} btn 
       * @param {HTMLElement} block 
       */
      function disablePickButton(btn, block) {
        btn.disabled = true;
        block.classList.add('disabled');
      }
      /**
       * Enable a button and visually enable the containing block
       * @param {HTMLElement} btn 
       * @param {HTMLElement} block 
       */
      function enablePickButton(btn, block) {
        btn.disabled = false;
        block.classList.remove('disabled');
      }

      /**
       * Main logic to pick winners in order:
       * 3rd place first, then 2nd, then 1st.
       * Each pick removes winner from the pool to avoid duplication.
       */
      async function initRaffle() {
        possibleWinners = await fetchWinnersFile();

        if (possibleWinners.length < 3) {
          alert('Not enough entries in Winners.txt to pick 3 winners. Please add more.');
          thirdBtn.disabled = true;
          secondBtn.disabled = true;
          firstBtn.disabled = true;
          return;
        }

        // Reset UI
        thirdNumber.textContent = '---';
        secondNumber.textContent = '---';
        firstNumber.textContent = '---';

        pickedWinners = [];

        enablePickButton(thirdBtn, thirdBlock);
        disablePickButton(secondBtn, secondBlock);
        disablePickButton(firstBtn, firstBlock);

        // Button Handlers
        thirdBtn.addEventListener('click', async () => {
          disablePickButton(thirdBtn, thirdBlock);
          // Animate rolling & pick
          const winner = await rollAnimation(thirdNumber, possibleWinners);
          pickedWinners.push(winner);
          // Remove winner from pool
          possibleWinners = possibleWinners.filter(n => n !== winner);
          // Enable next pick
          enablePickButton(secondBtn, secondBlock);
          secondBtn.focus();
        });

        secondBtn.addEventListener('click', async () => {
          disablePickButton(secondBtn, secondBlock);
          const winner = await rollAnimation(secondNumber, possibleWinners);
          pickedWinners.push(winner);
          possibleWinners = possibleWinners.filter(n => n !== winner);
          enablePickButton(firstBtn, firstBlock);
          firstBtn.focus();
        });

        firstBtn.addEventListener('click', async () => {
          disablePickButton(firstBtn, firstBlock);
          const winner = await rollAnimation(firstNumber, possibleWinners);
          pickedWinners.push(winner);
          possibleWinners = possibleWinners.filter(n => n !== winner);

          // All winners picked, show alert and final message
          // Accessibility: Announce completion
          alert(`ðŸŽ‰ Winners are:\n\n1st: ${pickedWinners[2]}\n2nd: ${pickedWinners[1]}\n3rd: ${pickedWinners[0]}\n\nThank you for participating!`);

          // Optionally: Enable a reset or reload (not required by user)
        });
      }

      window.addEventListener('load', () => {
        initRaffle();
      });

    })();
  </script>
</body>
</html>
