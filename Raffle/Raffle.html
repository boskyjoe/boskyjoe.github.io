<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>St. Sebastian's Church Raffle Winner Announcement</title>
  <style>
    /* Reset and basics */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f7f9fc;
      color: #333;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    a, button {
      cursor: pointer;
      outline: none;
      user-select: none;
    }

    /* Container */
    .container {
      max-width: 900px;
      margin: auto;
      padding: 1rem 1.5rem 5rem;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* Header */
    header {
      background: #004a99;
      color: white;
      width: 100%;
      padding: 1.25rem 1rem;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      border-bottom: 3px solid #febf01;
    }

    header img {
      height: 75px;
      width: auto;
      flex-shrink: 0;
      border-radius: 10px;
      background: white;
      padding: 5px;
      box-shadow: 0px 2px 6px rgba(0,0,0,0.3);
    }

    .header-text {
      flex: 1 1 300px;
      margin-left: 1rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .header-title {
      font-weight: 700;
      font-size: 1.6rem;
      line-height: 1.2;
      margin: 0 0 0.4rem;
      text-shadow: 0 1px 3px rgba(0,0,0,0.4);
    }
    .header-info {
      font-size: 0.9rem;
      line-height: 1.3;
      opacity: 0.9;
      max-width: 350px;
    }
    .header-info strong {
      font-weight: 600;
    }

    /* Winner Cards Container */
    .winner-cards {
      display: flex;
      flex-direction: column;
      gap: 2rem;
      width: 100%;
      max-width: 700px;
      margin: 3rem auto 1rem;
    }

    /* Common card styles */
    .winner-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.15);
      padding: 1.8rem 1.5rem 2rem;
      text-align: center;
      position: relative;
      user-select: none;
      transition: transform 0.2s ease;
    }
    .winner-card:hover:not(.disabled) {
      transform: scale(1.02);
      box-shadow: 0 8px 22px rgba(0,0,0,0.25);
    }
    .winner-card.disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    /* Titles */
    .winner-title {
      font-weight: 700;
      font-size: 1.2rem;
      letter-spacing: 0.07em;
      margin-bottom: 1rem;
      text-transform: uppercase;
      user-select: none;
    }

    /* Winner number display */
    .winner-number {
      font-family: 'Courier New', Courier, monospace;
      font-size: 4rem;
      font-weight: 700;
      letter-spacing: 0.02em;
      min-height: 5rem;
      margin-bottom: 2rem;
      color: #222;
      user-select: text;
      /* for centering animation content */
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
    }

    /* Animating numbers inside winner-number */
    .rolling-numbers {
      display: flex;
      gap: 0.4rem;
    }
    .rolling-numbers span {
      display: inline-block;
      font-size: 3.2rem;
      min-width: 2.8rem;
      text-align: center;
      color: #555;
      animation: spinDigit 0.7s linear infinite;
    }
    @keyframes spinDigit {
      0% {
        transform: translateY(0);
      }
      100% {
        transform: translateY(-100%);
      }
    }

    /* Control Buttons */
    .btn {
      padding: 0.7rem 1.6rem;
      font-size: 1.1rem;
      font-weight: 700;
      border: none;
      border-radius: 9999px;
      color: white;
      transition: background-color 0.3s ease;
      box-shadow: 0 4px 9px rgba(0,0,0,0.2);
      user-select: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
    }
    .btn:active {
      transform: scale(0.97);
      box-shadow: 0 2px 6px rgba(0,0,0,0.17);
    }
    .btn:disabled,
    .btn.disabled {
      background-color: #a9a9a9 !important;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* Specific buttons and card colors */
    /* 3rd place - bronze */
    #third-place {
      border-top: 6px solid #cd7f32;
    }
    #third-place .winner-number {
      color: #8c4b12;
    }
    #third-place button {
      background-color: #cd7f32;
    }
    #third-place button:hover:not(:disabled) {
      background-color: #b26928;
    }

    /* 2nd place - silver */
    #second-place {
      border-top: 6px solid #c0c0c0;
    }
    #second-place .winner-number {
      color: #646464;
    }
    #second-place button {
      background-color: #c0c0c0;
      color: #222;
    }
    #second-place button:hover:not(:disabled) {
      background-color: #a3a3a3;
    }

    /* 1st place - gold */
    #first-place {
      border-top: 6px solid #ffd700;
    }
    #first-place .winner-number {
      color: #b8860b;
    }
    #first-place button {
      background-color: #ffd700;
      color: #333;
      font-weight: 800;
    }
    #first-place button:hover:not(:disabled) {
      background-color: #e6c200;
    }

    /* Reset button distinct style */
    #reset-btn {
      margin-top: 3rem;
      background-color: #004a99;
      color: #fff;
      font-weight: 700;
      padding: 0.8rem 2.2rem;
      border-radius: 9999px;
      box-shadow: 0 5px 15px rgba(0,74,153,0.7);
      user-select: none;
      transition: background-color 0.3s ease;
      display: none;
      align-self: center;
      min-width: 180px;
    }
    #reset-btn:hover:not(:disabled) {
      background-color: #00386b;
    }
    #reset-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Footer */
    footer {
      background: #004a99;
      color: white;
      text-align: center;
      padding: 1rem 1rem;
      font-size: 0.9rem;
      margin-top: auto;
      user-select: none;
      font-weight: 600;
    }
    footer small {
      display: block;
      margin-top: 0.2rem;
      font-weight: 400;
      font-size: 0.8rem;
      opacity: 0.85;
    }

    /* Responsive adjustments */
    @media (min-width: 600px) {
      header {
        flex-wrap: nowrap;
      }
      .winner-cards {
        flex-direction: row;
        justify-content: space-between;
      }
      .winner-card {
        width: 32%;
      }
      #reset-btn {
        margin-top: 4rem;
      }
    }

    /* Spinning animation for winner number during draw */
    .spinning span {
      animation: spinDigit 0.1s linear infinite;
      user-select: none;
    }
  </style>
</head>
<body>
  <header>
    <img
      src="https://static.wixstatic.com/media/df2113_f71b21a1906c4d2bace3f797f5a6a8bb~mv2.png/v1/crop/x_5,y_0,w_365,h_315/fill/w_174,h_150,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/LogoDesign-II%20(1)_edited.png"
      alt="St. Sebastian's Church Logo"
      loading="lazy"
    />
    <div class="header-text" role="banner" aria-label="Page header with title and contact info">
      <h1 class="header-title">St. Sebastian's Church Raffle Winner Announcement</h1>
      <address class="header-info">
        No:184/C, New Byppanahalli Extn, Indiranagar, Bengaluru â€“ 560038<br />
        <a href="tel:+917090424365" style="color:white; text-decoration:none; font-weight:600;">+91 7090424365</a> | 
        <a href="mailto:stsebastianssmc@gmail.com" style="color:white; text-decoration:none; font-weight:600;">stsebastianssmc@gmail.com</a>
      </address>
    </div>
  </header>

  <main class="container" role="main" aria-live="polite">
    <section class="winner-cards" aria-label="Raffle winners selection">
      <!-- 3rd Place Card -->
      <div id="third-place" class="winner-card" aria-labelledby="third-title">
        <h2 id="third-title" class="winner-title">3rd Place Winner</h2>
        <div id="third-number" class="winner-number" aria-live="polite" aria-atomic="true" aria-relevant="additions">--</div>
        <button id="third-btn" class="btn" aria-describedby="third-desc" type="button">Draw 3rd Winner</button>
        <span id="third-desc" class="visually-hidden">Click to randomly pick the 3rd place winner number</span>
      </div>

      <!-- 2nd Place Card (hidden initially) -->
      <div id="second-place" class="winner-card disabled" aria-labelledby="second-title" aria-hidden="true" hidden>
        <h2 id="second-title" class="winner-title">2nd Place Winner</h2>
        <div id="second-number" class="winner-number" aria-live="polite" aria-atomic="true" aria-relevant="additions">--</div>
        <button id="second-btn" class="btn" aria-describedby="second-desc" type="button" disabled>Draw 2nd Winner</button>
        <span id="second-desc" class="visually-hidden">Click to randomly pick the 2nd place winner number</span>
      </div>

      <!-- 1st Place Card (hidden initially) -->
      <div id="first-place" class="winner-card disabled" aria-labelledby="first-title" aria-hidden="true" hidden>
        <h2 id="first-title" class="winner-title">1st Place Winner</h2>
        <div id="first-number" class="winner-number" aria-live="polite" aria-atomic="true" aria-relevant="additions">--</div>
        <button id="first-btn" class="btn" aria-describedby="first-desc" type="button" disabled>Draw 1st Winner</button>
        <span id="first-desc" class="visually-hidden">Click to randomly pick the 1st place winner number</span>
      </div>
    </section>

    <button id="reset-btn" aria-label="Reset the raffle draw to start again" type="button">Reset Draw</button>
  </main>

  <footer role="contentinfo">
    &copy; 2025 St. Sebastian's Church. All rights reserved.
    <small>Powered by DataWings Solution</small>
  </footer>

  <script>
  (() => {
    'use strict';

    // Elements
    const thirdCard = document.getElementById('third-place');
    const secondCard = document.getElementById('second-place');
    const firstCard = document.getElementById('first-place');

    const thirdNumberEl = document.getElementById('third-number');
    const secondNumberEl = document.getElementById('second-number');
    const firstNumberEl = document.getElementById('first-number');

    const thirdBtn = document.getElementById('third-btn');
    const secondBtn = document.getElementById('second-btn');
    const firstBtn = document.getElementById('first-btn');

    const resetBtn = document.getElementById('reset-btn');

    // Store winners.txt URL
    const WINNERS_URL = 'Winners.txt';

    // State
    let possibleNumbers = [];
    let usedWinners = new Set();

    // Duration for spinning animation in milliseconds
    const SPIN_DURATION = 4000;
    const SPIN_FRAME_INTERVAL = 60;
    
    // Accessibility helper: visually hidden class for screen readers
    // (defined in JS in case needed)
    const visuallyHiddenCSSClass = 'visually-hidden';
    if(!document.querySelector(`.${visuallyHiddenCSSClass}`)){
      const style = document.createElement('style');
      style.innerHTML = `.${visuallyHiddenCSSClass}{
        position: absolute !important; 
        width: 1px !important; 
        height: 1px !important; 
        padding: 0 !important; 
        margin: -1px !important; 
        overflow: hidden !important; 
        clip: rect(0, 0, 0, 0) !important; 
        white-space: nowrap !important; 
        border: 0 !important; 
      }`;
      document.head.appendChild(style);
    }

    /**
     * Utility: Sleep for ms milliseconds
     * @param {number} ms 
     * @returns {Promise<void>}
     */
    function sleep(ms){
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    /**
     * Fetch the possible raffle numbers from Winners.txt
     * Assumes the file contains one number per line or numbers separated by commas/spaces.
     * @returns {Promise<number[]>}
     */
    async function fetchPossibleNumbers(){
      try {
        const resp = await fetch(WINNERS_URL, {cache: 'no-store'});
        if(!resp.ok) throw new Error('Failed to fetch numbers.');
        const text = await resp.text();

        // Extract numbers - split by any non-digit, filter valid positive numbers
        const numbers = text
          .split(/[\r\n,; ]+/)
          .map(str => str.trim())
          .filter(str => /^\d+$/.test(str))
          .map(Number);

        if(numbers.length === 0){
          throw new Error('No valid numbers found in Winners.txt.');
        }
        return numbers;
      } catch(err) {
        alert('ERROR: Unable to load raffle numbers. Please ensure Winners.txt is available and correctly formatted.\n' + err.message);
        return [];
      }
    }

    /**
     * Animate a random spinning digits display in the winner-number container.
     * We simulate rolling digits by quickly changing visible numbers.
     * 
     * @param {HTMLElement} container - The element to animate numbers inside of.
     * @param {number} winnerNumber - The final winner number to show.
     * @returns {Promise<void>} resolves after animation finishes.
     */
    function animateSpin(container, winnerNumber){
      return new Promise(resolve => {
        const finalStr = winnerNumber.toString();
        const length = finalStr.length;

        // Clear container and create spinning digits elements
        container.textContent = '';
        container.classList.add('spinning');
        container.style.fontVariantNumeric = 'tabular-nums';

        // Create spans for each digit
        let spans = [];
        for(let i=0; i<length; i++){
          const span = document.createElement('span');
          span.textContent = Math.floor(Math.random() * 10);
          spans.push(span);
          container.appendChild(span);
        }

        // Animate: change digits randomly for SPIN_DURATION ms, then show final digits
        let elapsed = 0;
        const interval = SPIN_FRAME_INTERVAL;
        const maxFrames = Math.floor(SPIN_DURATION/interval);

        const intervalId = setInterval(() => {
          elapsed += interval;
          for(let i=0; i<length; i++){
            // During first 80% of animation, random digits
            // After 80% start revealing correct digit from left to right progressively
            if(elapsed < SPIN_DURATION * 0.8){
              spans[i].textContent = Math.floor(Math.random() * 10);
            } else {
              const revealUpTo = Math.floor(((elapsed - SPIN_DURATION * 0.8) / (SPIN_DURATION * 0.2)) * length);
              for(let r=0; r<length; r++){
                if(r < revealUpTo){
                  spans[r].textContent = finalStr[r];
                  spans[r].style.color = '#222';
                  spans[r].style.fontWeight = '800';
                } else {
                  spans[r].textContent = Math.floor(Math.random() * 10);
                }
              }
            }
          }
          if(elapsed >= SPIN_DURATION){
            clearInterval(intervalId);
            container.classList.remove('spinning');
            // Final exact display
            container.textContent = finalStr;
            resolve();
          }
        }, interval);
      });
    }

    /**
     * Pick a random number from the possibleNumbers array excluding used winners, return it.
     * @returns {number|null} winner number or null if no available numbers
     */
    function pickRandomWinner(){
      const availableNumbers = possibleNumbers.filter(num => !usedWinners.has(num));
      if(availableNumbers.length === 0) return null;
      const randomIndex = Math.floor(Math.random() * availableNumbers.length);
      return availableNumbers[randomIndex];
    }

    /**
     * Enable or disable a card for clicking.
     * @param {HTMLElement} card 
     * @param {boolean} enabled 
     */
    function setCardEnabled(card, enabled){
      if(enabled){
        card.classList.remove('disabled');
        card.hidden = false;
        card.setAttribute('aria-hidden', 'false');
        const btn = card.querySelector('button');
        btn.disabled = false;
      } else {
        card.classList.add('disabled');
        card.hidden = true;
        card.setAttribute('aria-hidden', 'true');
        const btn = card.querySelector('button');
        btn.disabled = true;
      }
    }

    /**
     * Reset UI to initial state.
     */
    function resetDraw(){
      usedWinners.clear();

      // Reset winners display
      thirdNumberEl.textContent = '--';
      secondNumberEl.textContent = '--';
      firstNumberEl.textContent = '--';

      // Enable only 3rd place card button, hide others
      setCardEnabled(thirdCard, true);
      setCardEnabled(secondCard, false);
      setCardEnabled(firstCard, false);

      // Hide Reset button
      resetBtn.style.display = 'none';

      // Enable Reset btn in case it was disabled
      resetBtn.disabled = false;
    }

    /**
     * Main draw function for a card: runs animation and displays winner,
     * disables current card, enables the next card or reset button.
     * @param {HTMLElement} card 
     * @param {HTMLElement} numberEl 
     * @param {HTMLElement|null} nextCard If null, shows reset button
     */
    async function drawWinner(card, numberEl, nextCard){
      // Disable the current card's button immediately
      const btn = card.querySelector('button');
      btn.disabled = true;

      // Pick a random number excluding previous winners
      const winner = pickRandomWinner();
      if(winner === null){
        alert('No more available winners to draw!');
        return;
      }

      // Animate spin and show winner number
      await animateSpin(numberEl, winner);

      // Save winner so no repetition
      usedWinners.add(winner);

      // Disable current card interface (keep visible)
      card.classList.add('disabled');
      btn.disabled = true;

      if(nextCard){
        // Enable next card
        setCardEnabled(nextCard, true);
        // Focus next card's button - accessibility improvement
        nextCard.querySelector('button').focus();
      } else {
        // No next card = last winner drawn => show reset button
        resetBtn.style.display = 'inline-flex';
        resetBtn.focus();
      }
    }

    /**
     * Initialize all event listeners and start state.
     */
    async function init(){
      possibleNumbers = await fetchPossibleNumbers();
      if(possibleNumbers.length === 0){
        // Disable all functionality if no numbers are loaded
        setCardEnabled(thirdCard, false);
        setCardEnabled(secondCard, false);
        setCardEnabled(firstCard, false);
        resetBtn.style.display = 'none';
        alert('No possible winners loaded. Please check Winners.txt.');
        return;
      }

      resetDraw();

      // Attach listeners
      thirdBtn.addEventListener('click', () => drawWinner(thirdCard, thirdNumberEl, secondCard));
      secondBtn.addEventListener('click', () => drawWinner(secondCard, secondNumberEl, firstCard));
      firstBtn.addEventListener('click', () => drawWinner(firstCard, firstNumberEl, null));
      resetBtn.addEventListener('click', () => {
        resetDraw();
        // Focus first card's button
        thirdBtn.focus();
      });
    }

    // Run the initialization
    window.addEventListener('load', init);
  })();
  </script>
</body>
</html>
