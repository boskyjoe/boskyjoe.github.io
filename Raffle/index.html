<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Venus Lottery - Draw Winners</title>
<!-- Tailwind CSS CDN -->
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 flex flex-col items-center justify-center min-h-screen p-4 text-white">

<h1 class="text-3xl font-bold mb-6 text-yellow-400 text-center">Venus Lottery - Draw Winners</h1>

<!-- Drawing machine display -->
<div id="displayContainer" class="mb-8 w-64 h-24 flex items-center justify-center border-8 border-yellow-500 rounded-xl shadow-lg bg-gradient-to-br from-yellow-400 to-orange-500 select-none text-4xl font-mono" aria-label="Lottery Number">
  0000
</div>

<!-- Buttons -->
<div class="flex space-x-4 mb-8">
  <button id="drawBtn" class="bg-yellow-500 hover:bg-orange-500 text-white font-semibold py-3 px-6 rounded-lg shadow-lg transition">Draw Winners</button>
  <button id="resetBtn" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg shadow-lg transition">Reset</button>
</div>

<!-- Results display -->
<div id="results" class="text-xl font-semibold space-y-2 text-center"></div>

<script>
  const display = document.getElementById('displayContainer');
  const drawBtn = document.getElementById('drawBtn');
  const resetBtn = document.getElementById('resetBtn');
  const resultsDiv = document.getElementById('results');

let winners = [];
let loadedNumbers = [];
const currentDrawOrder = [3, 2, 1]; // Draw in order: 3rd, 2nd, 1st

// Load winners from external file
async function loadWinners() {
  try {
    const response = await fetch('Winners.txt');
    const text = await response.text();
    // Assume each line is a separate 4-digit number
    loadedNumbers = text.trim().split(/\r?\n/).map(n => n.trim()).filter(n => n.match(/^\d{4}$/));
  } catch (err) {
    alert('Failed to load Winners.txt. Please ensure the file exists in the same directory.');
  }
}

// Select a winner randomly from remaining loaded numbers
function getRandomWinner(exclude=[]) {
  const available = loadedNumbers.filter(n => !exclude.includes(n));
  if (available.length === 0) return null;
  const idx = Math.floor(Math.random() * available.length);
  return available[idx];
}

// Animate spinning for a set duration to suspensefully show numbers, then reveal finalNumber
function spinNumbers(duration=1500, finalNumber='0000') {
  return new Promise(resolve => {
    const startTime = performance.now();
    const interval = 50;
    const animate = () => {
      const now = performance.now();
      if (now - startTime >= duration) {
        display.textContent = finalNumber;
        resolve();
        return;
      }
      const randNum = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
      display.textContent = randNum;
      setTimeout(animate, interval);
    };
    animate();
  });
}

// Main function to coordinate drawing
async function drawWinners() {
  await loadWinners();
  if (loadedNumbers.length === 0) {
    resultsDiv.innerHTML = `<div class="text-red-500">No winners loaded. Please check ` Winners.txt `.</div>`;
    return;
  }

  resultsDiv.innerHTML = '';
  winners = [];

  for (const position of currentDrawOrder) {
    const winner = getRandomWinner(winners);
    if (!winner) {
      resultsDiv.innerHTML += `<div class="text-red-400">No more unique winners available.</div>`;
      break;
    }
    // Animate spinning to the winner
    await spinNumbers(1500, winner);
    winners.push(winner);
