<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Raffle Draw Machine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Fonts + Material Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

  <!-- Material Web Components -->
  <script type="module" src="https://esm.run/@material/web/all.js"></script>

  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: radial-gradient(circle, #0f2027, #203a43, #2c5364);
      color: white;
    }

    .ball {
      @apply w-16 h-16 rounded-full bg-yellow-400 text-black font-bold flex items-center justify-center shadow-md text-lg;
    }

    .ball.drawn {
      @apply bg-green-500 scale-125;
    }

    .ball-container {
      position: relative;
      width: 300px;
      height: 300px;
    }

    .ball-anim {
      position: absolute;
      transition: all 0.3s ease-in-out;
    }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4 space-y-6">
  <h1 class="text-3xl font-bold text-white">ðŸŽ‰ Raffle Draw</h1>

  <div id="ballContainer" class="ball-container"></div>

  <div class="text-lg text-center space-y-2">
    <p><strong>3rd Place:</strong> <span id="place3">â€“</span></p>
    <p><strong>2nd Place:</strong> <span id="place2">â€“</span></p>
    <p><strong>1st Place:</strong> <span id="place1">â€“</span></p>
  </div>

  <div class="flex gap-4 mt-4">
    <mwc-button raised label="Draw" icon="play_arrow" id="drawBtn"></mwc-button>
    <mwc-button outlined label="Reset" icon="refresh" id="resetBtn"></mwc-button>
  </div>

  <div id="status" class="text-sm text-gray-300 mt-4"></div>

  <script>
    const drawBtn = document.getElementById('drawBtn');
    const resetBtn = document.getElementById('resetBtn');
    const statusEl = document.getElementById('status');
    const place1 = document.getElementById('place1');
    const place2 = document.getElementById('place2');
    const place3 = document.getElementById('place3');
    const ballContainer = document.getElementById('ballContainer');

    let tickets = [];
    let drawn = [];

    // Utility to create animated ball elements
    function showBalls(numbers) {
      ballContainer.innerHTML = '';
      numbers.forEach((num, i) => {
        const div = document.createElement('div');
        div.className = 'ball ball-anim';
        div.textContent = num;
        const angle = Math.random() * Math.PI * 2;
        const radius = 120;
        div.style.left = `${radius * Math.cos(angle) + 120}px`;
        div.style.top = `${radius * Math.sin(angle) + 120}px`;
        ballContainer.appendChild(div);
      });
    }

    function fetchWinners() {
      fetch('Winners.txt')
        .then(res => res.ok ? res.text() : Promise.reject('Fetch failed'))
        .then(text => {
          tickets = text
            .split(/\r?\n/)
            .map(line => line.trim())
            .filter(line => line.length > 0);
          statusEl.textContent = `Loaded ${tickets.length} entries from Winners.txt`;
        })
        .catch(err => {
          console.error(err);
          statusEl.textContent = 'Failed to load Winners.txt';
        });
    }

    function drawUnique(count) {
      if (tickets.length < count) return [];

      const temp = [...tickets];
      const result = [];

      for (let i = 0; i < count; i++) {
        const idx = Math.floor(Math.random() * temp.length);
        result.push(temp.splice(idx, 1)[0]);
      }
      return result;
    }

    function drawSequence() {
      if (tickets.length < 3) {
        alert('Not enough entries to draw 3 winners.');
        return;
      }

      drawBtn.disabled = true;
      resetBtn.disabled = true;
      place1.textContent = place2.textContent = place3.textContent = 'â€“';

      drawn = drawUnique(3);
      showBalls(drawn);

      // Sequential reveal
      setTimeout(() => {
        place3.textContent = drawn[0];
      }, 1000);

      setTimeout(() => {
        place2.textContent = drawn[1];
      }, 2000);

      setTimeout(() => {
        place1.textContent = drawn[2];
        drawBtn.disabled = false;
        resetBtn.disabled = false;
      }, 3000);
    }

    drawBtn.addEventListener('click', drawSequence);

    resetBtn.addEventListener('click', () => {
      place1.textContent = place2.textContent = place3.textContent = 'â€“';
      ballContainer.innerHTML = '';
    });

    window.addEventListener('DOMContentLoaded', fetchWinners);
  </script>
</body>
</html>
