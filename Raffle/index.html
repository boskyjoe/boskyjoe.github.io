<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Raffle Draw Machine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />

  <!-- Material Web Components -->
  <script type="module" src="https://cdn.jsdelivr.net/npm/@material/web@latest/button/filled-button.js"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@material/web@latest/button/outlined-button.js"></script>

  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: radial-gradient(circle, #0f2027, #203a43, #2c5364);
      color: white;
    }
    .ball {
      width: 64px;
      height: 64px;
      border-radius: 9999px;
      background-color: #facc15; /* Tailwind amber-400 */
      color: black;
      font-weight: 700;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 4px 6px rgb(0 0 0 / 0.3);
      font-size: 1.25rem;
      transition: transform 0.3s ease;
      position: absolute;
    }
    .ball.drawn {
      background-color: #22c55e; /* Tailwind green-500 */
      transform: scale(1.3);
      transition: transform 0.5s ease;
    }
    #ballContainer {
      position: relative;
      width: 320px;
      height: 320px;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-6 space-y-6">

  <h1 class="text-4xl font-bold">ðŸŽ‰ Raffle Draw</h1>

  <div id="ballContainer"></div>

  <div class="text-xl text-center space-y-2">
    <p>3rd Place: <span id="place3">â€“</span></p>
    <p>2nd Place: <span id="place2">â€“</span></p>
    <p>1st Place: <span id="place1">â€“</span></p>
  </div>

  <div class="flex gap-4">
    <mwc-filled-button id="drawBtn" label="Draw"></mwc-filled-button>
    <mwc-outlined-button id="resetBtn" label="Reset"></mwc-outlined-button>
  </div>

  <div id="status" class="mt-2 text-gray-300"></div>

  <script>
    const drawBtn = document.getElementById('drawBtn');
    const resetBtn = document.getElementById('resetBtn');
    const statusEl = document.getElementById('status');
    const placeEls = [
      document.getElementById('place3'),
      document.getElementById('place2'),
      document.getElementById('place1'),
    ];
    const ballContainer = document.getElementById('ballContainer');

    let tickets = [];

    // Load tickets from Winners.txt on page load
    window.addEventListener('DOMContentLoaded', () => {
      fetch('Winners.txt')
        .then(res => {
          if (!res.ok) throw new Error('Could not load Winners.txt');
          return res.text();
        })
        .then(text => {
          tickets = text.split(/\r?\n/).map(line => line.trim()).filter(line => line);
          statusEl.textContent = `Loaded ${tickets.length} entries`;
        })
        .catch(err => {
          console.error(err);
          statusEl.textContent = 'Failed to load Winners.txt';
        });
    });

    function clearDraw() {
      ballContainer.innerHTML = '';
      placeEls.forEach(el => (el.textContent = 'â€“'));
      statusEl.textContent = `Loaded ${tickets.length} entries`;
    }

    function drawBalls() {
      if (tickets.length < 3) {
        alert('Not enough entries in Winners.txt to draw 3 winners.');
        return;
      }

      drawBtn.disabled = true;
      resetBtn.disabled = true;
      placeEls.forEach(el => (el.textContent = 'â€“'));
      ballContainer.innerHTML = '';

      // Pick 3 unique random tickets
      const pool = [...tickets];
      const drawn = [];
      for (let i = 0; i < 3; i++) {
        const idx = Math.floor(Math.random() * pool.length);
        drawn.push(pool.splice(idx, 1)[0]);
      }

      // Show balls randomly positioned in container
      drawn.forEach((num, i) => {
        const ball = document.createElement('div');
        ball.className = 'ball';
        ball.textContent = num;
        // Random position inside container circle radius ~120px
        const angle = Math.random() * 2 * Math.PI;
        const radius = 120;
        ball.style.left = `${radius * Math.cos(angle) + 130}px`;
        ball.style.top = `${radius * Math.sin(angle) + 130}px`;
        ballContainer.appendChild(ball);

        // Animate scale and reveal place text sequentially
        setTimeout(() => {
          ball.classList.add('drawn');
          placeEls[i].textContent = num;
          if (i === 2) {
            drawBtn.disabled = false;
            resetBtn.disabled = false;
            statusEl.textContent = 'Draw complete!';
          }
        }, 1000 * (i + 1));
      });
    }

    drawBtn.addEventListener('click', drawBalls);
    resetBtn.addEventListener('click', clearDraw);
  </script>
</body>
</html>
