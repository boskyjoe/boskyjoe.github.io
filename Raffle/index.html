<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>St. Sebastian's Church Raffle</title>
<!-- Google Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;600;700;800&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
<style>
  /* ... (Your CSS remains unchanged, omitted here for brevity) ... */
  /* (Use the same CSS from previous code block) */
</style>
</head>
<body>
<div class="container">
  <!-- Header -->
  <header>
    <img src="https://static.wixstatic.com/media/df2113_f71b21a1906c4d2bace3f797f5a6a8bb~mv2.png/v1/crop/x_5,y_0,w_365,h_315/fill/w_87,h_75,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/LogoDesign-II%20(1)_edited.png" alt="St. Sebastian's Logo" />
    <div class="info">
      <h1>St. Sebastian's Church Raffle Winner Announcement</h1>
      <div>No:184/C, New Byppanahalli Extn, Indiranagar, Bengaluru ‚Äì 560038</div>
      <div><span class="material-icons" style="font-size:16px;">contact_phone</span> +91 7090424365 | stsebastianssmc@gmail.com</div>
    </div>
  </header>

  <!-- Main Content -->
  <main>
    <!-- Raffle Draw -->
    <section class="section-box raffle-box">
      <h2 style="text-align: center;">Raffle Draw</h2>
      <div class="balls-container">
        <div class="ball" id="ball1" style="background: linear-gradient(135deg, #f7971e, #ffd200);"><div class="inner-text">üé≤</div></div>
        <div class="ball" id="ball2" style="background: linear-gradient(135deg, #6a11cb, #2575fc);"><div class="inner-text">üé≤</div></div>
        <div class="ball" id="ball3" style="background: linear-gradient(135deg, #43cea2, #185a9d);"><div class="inner-text">üé≤</div></div>
      </div>
      <div style="text-align:center; margin-top:20px;">
        <button id="drawBtn" class="draw-btn">Generate 3rd Place Winner</button>
      </div>
    </section>

    <!-- Winners display section -->
    <section class="section-box winners-box" id="winnersSection">
      <h2 style="text-align: center;">üèÜ Winners</h2>
      <div style="text-align:center; font-style:italic; color:#999; padding:20px;">Winners will appear here after the first number is drawn</div>
      <div id="winnersList"></div>
      <div id="congrats" style="display:none; margin-top:20px;">üéâ Congratulations! Contact the church office.</div>
    </section>
  </main>
</div>
<!-- Confetti burst container -->
<div id="confettiContainer"></div>
<!-- Footer -->
<footer>
  ¬© 2023 St. Sebastian's Church. All rights reserved.<br>
  Powered by DataWings Solution
</footer>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Your JavaScript code here, wrapped in DOMContentLoaded
    const positions = {
      'first': { emoji: 'ü•á', text: '1st Place' },
      'second': { emoji: 'ü•à', text: '2nd Place' },
      'third': { emoji: 'ü•â', text: '3rd Place' }
    };
    const stepMessages = {
      0: { label: 'Generate 3rd Place Winner', text: '3rd Place' },
      1: { label: 'Generate 2nd Place Winner', text: '2nd Place' },
      2: { label: 'Generate 1st Place Winner', text: '1st Place' }
    };

    const STEP_3RD = 0;
    const STEP_2ND = 1;
    const STEP_1ST = 2;
    let currentStep = STEP_3RD;

    let availableNumbers = [];
    let winnersData = [
      "001","002","003","004","005","006","007","008","009","010",
      "011","012","013","014","015","016","017","018","019","020",
      "021","022","023","024","025"
    ];

    let isDrawing = false;

    function initDraw() {
      currentStep = STEP_3RD;
      availableNumbers = [...winnersData];
      document.querySelectorAll('.ball').forEach(b => {
        b.innerHTML = '<div class="inner-text">üé≤</div>';
        b.className='ball';
      });
      document.getElementById('winnersList').innerHTML = '';
      document.getElementById('congrats').style.display='none';

      const winnersSection = document.getElementById('winnersSection');
      winnersSection.style.opacity=0;
      winnersSection.style.transform='translateY(20px)';
      winnersSection.classList.remove('show');

      updateButtonLabel();
    }

    function showWinnersSection() {
      const section = document.getElementById('winnersSection');
      section.style.opacity=1;
      section.style.transform='translateY(0)';
      section.classList.add('show');
    }

    async function spinBall(ball, winnerNumber) {
      return new Promise((resolve) => {
        ball.classList.add('spinning');
        let count=0;
        const interval = setInterval(() => {
          const randIdx = Math.floor(Math.random() * availableNumbers.length);
          ball.innerHTML = '<div class="inner-text">' + availableNumbers[randIdx] + '</div>';
          count++;
          if (count > 20) {
            clearInterval(interval);
            ball.innerHTML = '<div class="inner-text">' + winnerNumber + '</div>';
            ball.classList.remove('spinning');
            ball.classList.add('active');
            resolve();
          }
        }, 120);
      });
    }

    async function drawNext() {
      if (isDrawing || availableNumbers.length === 0) return;
      isDrawing = true;
      document.getElementById('drawBtn').disabled=true;

      let ballId='', place='';
      switch(currentStep){
        case STEP_3RD: ballId='ball3'; place='third'; break;
        case STEP_2ND: ballId='ball2'; place='second'; break;
        case STEP_1ST: ballId='ball1'; place='first'; break;
      }

      const randIdx = Math.floor(Math.random() * availableNumbers.length);
      const winnerNumber = availableNumbers[randIdx];
      availableNumbers.splice(randIdx,1);

      const ball = document.getElementById(ballId);
      await spinBall(ball, winnerNumber);

      // Append winner info
      const listDiv = document.getElementById('winnersList');
      const div = document.createElement('div');
      div.className='winner-card '+place;
      div.innerHTML= `
        <div class="winner-position">${positions[place].emoji}</div>
        <div class="winner-details">
          <div class="winner-place">${positions[place].text}</div>
          <div class="winner-number">${winnerNumber}</div>
        </div>`;
      listDiv.prepend(div);

      if(currentStep===STEP_3RD) showWinnersSection();
      if(currentStep===STEP_1ST) document.getElementById('congrats').style.display='block';

      launchConfettiBurst();
      if(currentStep===STEP_3RD) launchBigCelebration();

      currentStep++;
      updateButtonLabel();

      setTimeout(() => clearConfetti(), 3000);
      document.getElementById('drawBtn').disabled=false;
      isDrawing=false;
    }

    function launchConfettiBurst() {
      const container=document.getElementById('confettiContainer');
      const cx=window.innerWidth/2;
      const cy=window.innerHeight/2;
      for(let i=0;i<80;i++) createFlowingConfettiParticle(container, cx, cy);
    }

    function createFlowingConfettiParticle(container, startX, startY, big=false) {
      const el=document.createElement('div');
      el.style.position='absolute';
      const size= big ? Math.random()*12+8 : Math.random()*4+2;
      el.style.width=`${size}px`;
      el.style.height=`${size}px`;
      el.style.borderRadius='50%';
      el.style.backgroundColor=`hsl(${Math.random()*360},70%,60%)`;
      el.style.left=`${startX}px`;
      el.style.top=`${startY}px`;

      const angle=Math.random()*Math.PI*2;
      let dx=Math.cos(angle)*(Math.random()*4+2);
      let dy=Math.sin(angle)*(Math.random()*4+2);
      let currentX=startX;
      let currentY=startY;
      const maxLifetime=80;
      let lifetime=0;

      container.appendChild(el);

      function step() {
        if(lifetime>=maxLifetime) {
          if(container.contains(el)) container.removeChild(el);
          return;
        }
        dx*=0.98; dy*=0.98; // easing
        currentX+=dx;
        currentY+=dy;
        el.style.transform=`translate(${currentX - startX}px, ${currentY - startY}px) rotate(${Math.random()*360}deg)`;
        el.style.opacity=1-(lifetime/maxLifetime);
        lifetime++;
        requestAnimationFrame(step);
      }
      step();
    }

    function clearConfetti() {
      document.getElementById('confettiContainer').innerHTML='';
    }

    function launchBigCelebration() {
      for(let i=0;i<100;i++) createFlowingConfettiParticle(document.getElementById('confettiContainer'), window.innerWidth/2, window.innerHeight/2, true);
    }

    // Button click handler
    document.getElementById('drawBtn').addEventListener('click', () => {
      if (currentStep<=2) {
        drawNext();
      } else {
        initDraw();
      }
    });

    // Initialize on load
    initDraw();
    updateButtonLabel();

    function updateButtonLabel() {
      const btn = document.getElementById('drawBtn');
      if(currentStep<=2){
        btn.textContent=stepMessages[currentStep].label;
      } else {
        btn.textContent='Start New Draw';
      }
    }
  });
</script>
</body>
</html>
