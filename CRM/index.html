<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShutterSync CRM</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS File -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-gray-50">
    <!-- Modal Container -->
    <div id="modalContainer"></div>

    <!-- Header / Navigation Bar -->
    <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">ShutterSync CRM</h1>

            <!-- Desktop Navigation -->
            <nav class="hidden md:flex items-center space-x-6">
                <a href="#" data-section="home" class="hover:text-blue-200 transition duration-300">Home</a>
                <a href="#" data-section="customers-section" class="hover:text-blue-200 transition duration-300">Customers</a>
                <a href="#" data-section="opportunities-section" class="hover:text-blue-200 transition duration-300">Opportunities</a>
                <a href="#" data-section="events-section" class="hover:text-blue-200 transition duration-300">Events</a>

                <!-- Desktop Admin Dropdown Menu -->
                <div id="desktopAdminMenu" class="relative group hidden">
                    <a href="#" id="desktopAdminMenuToggle" class="hover:text-blue-200 transition duration-300 flex items-center">
                        Admin <i class="fas fa-chevron-down ml-1 text-xs"></i>
                    </a>
                    <ul id="desktopAdminSubMenu" class="absolute left-0 mt-2 w-48 bg-white text-gray-800 rounded-md shadow-lg py-2 z-20 hidden">
                        <li><a href="#" data-section="admin-country-mapping-section" class="block px-4 py-2 hover:bg-gray-100">Country Mapping</a></li>
                        <li><a href="#" data-section="currency-management-section" class="block px-4 py-2 hover:bg-gray-100">Currency Management</a></li>
                        <li><a href="#" data-section="users-management-section" class="block px-4 py-2 hover:bg-gray-100">User Management</a></li>
                    </ul>
                </div>

                <!-- Google Login/User ID/Logout for Desktop -->
                <div class="flex items-center space-x-4">
                    <span id="userIdDisplay" class="text-sm font-medium hidden"></span>
                    <button id="navGoogleLoginButton" class="bg-white text-blue-600 px-4 py-2 rounded-md hover:bg-blue-100 transition duration-300 shadow">Sign in with Google</button>
                    <button id="logoutButton" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-300 shadow hidden">Logout</button>
                </div>
            </nav>

            <!-- Mobile Menu Button (Hamburger) -->
            <div class="md:hidden flex items-center">
                <span id="mobileUserIdDisplay" class="text-sm font-medium mr-4 hidden"></span>
                <button id="mobileMenuButton" class="text-white focus:outline-none">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Mobile Navigation (hidden by default, toggled by JS) -->
    <div id="mobileMenu" class="md:hidden bg-blue-700 text-white overflow-hidden shadow-md">
        <nav class="px-2 pt-2 pb-4 space-y-1 sm:px-3">
            <a href="#" data-section="home" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-600">Home</a>
            <a href="#" data-section="customers-section" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-600">Customers</a>
            <a href="#" data-section="opportunities-section" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-600">Opportunities</a>
            <a href="#" data-section="events-section" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-600">Events</a>

            <!-- Mobile Admin Dropdown Menu -->
            <div id="mobileAdminMenu" class="relative group hidden">
                <a href="#" id="mobileAdminMenuToggle" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-600 flex items-center justify-between">
                    Admin <i class="fas fa-chevron-down ml-1 text-xs"></i>
                </a>
                <ul id="mobileAdminSubMenu" class="pl-6 py-1 space-y-1 hidden">
                    <li><a href="#" data-section="admin-country-mapping-section" class="block px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-600">Country Mapping</a></li>
                    <li><a href="#" data-section="currency-management-section" class="block px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-600">Currency Management</a></li>
                    <li><a href="#" data-section="users-management-section" class="block px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-600">User Management</a></li>
                </ul>
            </div>

            <!-- Mobile Logout Button -->
            <button id="mobileLogoutButton" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium bg-blue-600 hover:bg-blue-500 transition duration-300 shadow hidden">Logout</button>
        </nav>
    </div>

    <!-- Main Content Area -->
    <main class="container mx-auto p-6">
        <!-- Home Section -->
        <section id="home" class="flex flex-col items-center justify-center min-h-screen-minus-header text-center space-y-6">
            <h2 class="text-5xl font-extrabold text-blue-700 leading-tight">Welcome to ShutterSync CRM</h2>
            <p class="text-xl text-gray-600 max-w-2xl">Your all-in-one solution for managing customers, opportunities, and events with ease.</p>
            <div id="auth-section">
                <button id="googleLoginButton" class="bg-blue-600 text-white px-8 py-3 rounded-lg shadow-lg hover:bg-blue-700 transition duration-300 text-lg font-semibold">
                    <i class="fab fa-google mr-2"></i> Sign in with Google
                </button>
            </div>
            <p class="text-gray-500 text-sm mt-4">Please sign in to access CRM features.</p>
        </section>

        <!-- Customers Section -->
        <section id="customers-section" class="hidden bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-3xl font-bold text-blue-700 mb-6">Customer Management</h2>

            <!-- Customer Form -->
            <form id="customerForm" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 p-6 bg-gray-50 rounded-lg shadow-inner">
                <h3 id="customerFormTitle" class="text-2xl font-semibold text-gray-800 mb-4 md:col-span-2">Add New Customer</h3>

                <div id="customerIdDisplayGroup" class="mb-4 md:col-span-2 hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Customer ID:</label>
                    <span id="customerIdDisplay" class="text-lg font-mono text-blue-700"></span>
                </div>

                <div class="mb-4">
                    <label for="customerType" class="block text-sm font-medium text-gray-700 mb-1">Customer Type <span class="text-red-500">*</span></label>
                    <select id="customerType" name="customerType" required class="form-input-style">
                        <option value="Individual">Individual</option>
                        <option value="Company">Company</option>
                    </select>
                </div>

                <!-- Fields for Individual Customer Type -->
                <div id="individualFields" class="grid grid-cols-1 sm:grid-cols-2 gap-6 md:col-span-2">
                    <div class="mb-4">
                        <label for="customerFirstName" class="block text-sm font-medium text-gray-700 mb-1">First Name <span class="text-red-500">*</span></label>
                        <input type="text" id="customerFirstName" name="firstName" class="form-input-style">
                    </div>
                    <div class="mb-4">
                        <label for="customerLastName" class="block text-sm font-medium text-gray-700 mb-1">Last Name <span class="text-red-500">*</span></label>
                        <input type="text" id="customerLastName" name="lastName" class="form-input-style">
                    </div>
                </div>

                <!-- Fields for Company Customer Type -->
                <div id="companyNameField" class="mb-4 md:col-span-2 hidden">
                    <label for="customerCompanyName" class="block text-sm font-medium text-gray-700 mb-1">Company Name <span class="text-red-500">*</span></label>
                    <input type="text" id="customerCompanyName" name="companyName" class="form-input-style">
                </div>

                <div class="mb-4">
                    <label for="customerEmail" class="block text-sm font-medium text-gray-700 mb-1">Email <span class="text-red-500">*</span></label>
                    <input type="email" id="customerEmail" name="email" required class="form-input-style">
                </div>
                <div class="mb-4">
                    <label for="customerPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone <span class="text-red-500">*</span></label>
                    <input type="tel" id="customerPhone" name="phone" required class="form-input-style">
                </div>

                <!-- Address Fields -->
                <div class="mb-4 md:col-span-2">
                    <label for="customerAddress" class="block text-sm font-medium text-gray-700 mb-1">Address <span class="text-red-500">*</span></label>
                    <input type="text" id="customerAddress" name="address" required class="form-input-style">
                </div>
                <div class="mb-4">
                    <label for="customerCity" class="block text-sm font-medium text-gray-700 mb-1">City <span class="text-red-500">*</span></label>
                    <input type="text" id="customerCity" name="city" required class="form-input-style">
                </div>
                <div class="mb-4">
                    <label for="customerCountry" class="block text-sm font-medium text-gray-700 mb-1">Country <span class="text-red-500">*</span></label>
                    <select id="customerCountry" name="country" required class="form-input-style"></select>
                </div>
                <div class="mb-4">
                    <label for="customerState" class="block text-sm font-medium text-gray-700 mb-1">State/Province <span class="text-red-500">*</span></label>
                    <select id="customerState" name="state" required class="form-input-style"></select>
                </div>
                <div class="mb-4">
                    <label for="customerZipCode" class="block text-sm font-medium text-gray-700 mb-1">Zip Code <span class="text-red-500">*</span></label>
                    <input type="text" id="customerZipCode" name="zipCode" required class="form-input-style">
                </div>
                <div id="addressValidationMessage" class="md:col-span-2 text-red-600 text-sm hidden"></div>


                <!-- Conditional Industry Fields -->
                <div id="individualIndustryGroup" class="mb-4">
                    <label for="customerIndustryInput" class="block text-sm font-medium text-gray-700 mb-1">Industry (Individual) <span class="text-red-500">*</span></label>
                    <input type="text" id="customerIndustryInput" name="industry" class="form-input-style">
                </div>
                <div id="companyIndustryGroup" class="mb-4 hidden">
                    <label for="customerIndustrySelect" class="block text-sm font-medium text-gray-700 mb-1">Industry (Company) <span class="text-red-500">*</span></label>
                    <select id="customerIndustrySelect" name="industry" class="form-input-style">
                        <option value="">Select Industry</option>
                        <option value="Technology">Technology</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Finance">Finance</option>
                        <option value="Retail">Retail</option>
                        <option value="Manufacturing">Manufacturing</option>
                        <option value="Education">Education</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label for="customerSince" class="block text-sm font-medium text-gray-700 mb-1">Customer Since <span class="text-red-500">*</span></label>
                    <input type="date" id="customerSince" name="customerSince" required class="form-input-style">
                </div>
                <div class="mb-4 md:col-span-2">
                    <label for="customerDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea id="customerDescription" name="description" rows="3" class="form-input-style"></textarea>
                </div>

                <div class="md:col-span-2 flex justify-end space-x-3">
                    <button type="button" id="resetCustomerFormButton" class="px-5 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Reset
                    </button>
                    <button type="submit" id="submitCustomerButton" class="px-5 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Add Customer
                    </button>
                </div>
            </form>

            <!-- Customer List -->
            <div class="mt-8 bg-white p-6 rounded-lg shadow-md overflow-x-auto">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Existing Customers</h3>
                <div class="data-grid-header grid grid-cols-[100px_minmax(150px,_1.5fr)_1.5fr_1fr_1.5fr_1fr_0.8fr_1.5fr]">
                    <div class="px-2 py-1">ID</div>
                    <div class="px-2 py-1">Name</div>
                    <div class="px-2 py-1">Email</div>
                    <div class="px-2 py-1 hidden md:block">Phone</div>
                    <div class="px-2 py-1 hidden lg:block">Address</div>
                    <div class="px-2 py-1 hidden lg:block">Industry</div>
                    <div class="px-2 py-1 hidden sm:block">Since</div>
                    <div class="px-2 py-1 text-right">Actions</div>
                </div>
                <div id="customerList" class="divide-y divide-gray-100">
                    <!-- Customer rows will be dynamically inserted here -->
                    <p class="text-gray-500 text-center col-span-full py-4">Loading customers...</p>
                </div>
            </div>
        </section>

        <!-- Opportunities Section -->
        <section id="opportunities-section" class="hidden bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-3xl font-bold text-blue-700 mb-6">Opportunity Management</h2>

            <div id="opportunity-view-container" class="flex flex-col md:flex-row gap-6">
                <!-- Left Panel: Opportunity Form & List -->
                <div id="opportunity-left-panel" class="opportunity-panel w-full md:w-7/10">
                    <!-- Opportunity Form -->
                    <form id="opportunityForm" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 p-6 bg-gray-50 rounded-lg shadow-inner">
                        <h3 id="opportunityFormTitle" class="text-2xl font-semibold text-gray-800 mb-4 md:col-span-2">Add New Opportunity</h3>

                        <div id="opportunityIdDisplayGroup" class="mb-4 md:col-span-2 hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Opportunity ID:</label>
                            <span id="opportunityIdDisplay" class="text-lg font-mono text-blue-700"></span>
                        </div>

                        <div class="mb-4">
                            <label for="opportunityCustomer" class="block text-sm font-medium text-gray-700 mb-1">Customer <span class="text-red-500">*</span></label>
                            <select id="opportunityCustomer" name="customer" required class="form-input-style"></select>
                        </div>

                        <div class="mb-4">
                            <label for="opportunityName" class="block text-sm font-medium text-gray-700 mb-1">Opportunity Name <span class="text-red-500">*</span></label>
                            <input type="text" id="opportunityName" name="opportunityName" required class="form-input-style">
                        </div>

                        <div class="mb-4 flex items-end">
                            <div class="flex-grow">
                                <label for="opportunityAmount" class="block text-sm font-medium text-gray-700 mb-1">Amount <span class="text-red-500">*</span></label>
                                <input type="number" id="opportunityAmount" name="amount" required min="0" step="0.01" class="form-input-style rounded-r-none">
                            </div>
                            <span id="currencySymbolDisplay" class="bg-gray-200 p-2 border border-gray-300 border-l-0 rounded-r-md text-gray-600 py-2 sm:text-sm flex items-center"></span>
                        </div>

                        <div class="mb-4">
                            <label for="opportunityCurrency" class="block text-sm font-medium text-gray-700 mb-1">Currency <span class="text-red-500">*</span></label>
                            <select id="opportunityCurrency" name="currency" required class="form-input-style"></select>
                        </div>

                        <div class="mb-4">
                            <label for="opportunityStage" class="block text-sm font-medium text-gray-700 mb-1">Stage <span class="text-red-500">*</span></label>
                            <select id="opportunityStage" name="stage" required class="form-input-style">
                                <option value="">Select Stage</option>
                                <option value="New Lead">New Lead</option>
                                <option value="Qualification">Qualification</option>
                                <option value="Proposal Sent">Proposal Sent</option>
                                <option value="Negotiation">Negotiation</option>
                                <option value="Closed Won">Closed Won</option>
                                <option value="Closed Lost">Closed Lost</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label for="opportunityExpectedStartDate" class="block text-sm font-medium text-gray-700 mb-1">Expected Start Date <span class="text-red-500">*</span></label>
                            <input type="date" id="opportunityExpectedStartDate" name="expectedStartDate" required class="form-input-style">
                        </div>

                        <div class="mb-4">
                            <label for="opportunityExpectedCloseDate" class="block text-sm font-medium text-gray-700 mb-1">Expected Close Date <span class="text-red-500">*</span></label>
                            <input type="date" id="opportunityExpectedCloseDate" name="expectedCloseDate" required class="form-input-style">
                        </div>

                        <div class="mb-4">
                            <label for="opportunityEventType" class="block text-sm font-medium text-gray-700 mb-1">Event Type <span class="text-red-500">*</span></label>
                            <select id="opportunityEventType" name="eventType" required class="form-input-style">
                                <option value="">Select Type</option>
                                <option value="Wedding">Wedding</option>
                                <option value="Corporate Event">Corporate Event</option>
                                <option value="Birthday Party">Birthday Party</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label for="opportunityEventLocationProposed" class="block text-sm font-medium text-gray-700 mb-1">Proposed Event Location <span class="text-red-500">*</span></label>
                            <input type="text" id="opportunityEventLocationProposed" name="eventLocationProposed" required class="form-input-style">
                        </div>

                        <div class="mb-4 md:col-span-2">
                            <label for="opportunityServiceAddress" class="block text-sm font-medium text-gray-700 mb-1">Service Address <span class="text-red-500">*</span></label>
                            <input type="text" id="opportunityServiceAddress" name="serviceAddress" required class="form-input-style" placeholder="Auto-filled from customer, or enter manually">
                        </div>

                        <div class="mb-4 md:col-span-2">
                            <label for="opportunityDescription" class="block text-sm font-medium text-gray-700 mb-1">Description <span class="text-red-500">*</span></label>
                            <textarea id="opportunityDescription" name="description" rows="3" required class="form-input-style"></textarea>
                        </div>

                        <div class="mb-4 md:col-span-2">
                            <label for="opportunityData" class="block text-sm font-medium text-gray-700 mb-1">Additional Opportunity Data (JSON)</label>
                            <textarea id="opportunityData" name="opportunityData" rows="3" class="form-input-style" placeholder='{"key": "value"}'></textarea>
                            <p class="text-xs text-gray-500 mt-1">Optional: Enter valid JSON data.</p>
                        </div>

                        <div class="md:col-span-2 flex justify-end space-x-3">
                            <button type="button" id="resetOpportunityFormButton" class="px-5 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                Reset
                            </button>
                            <button type="submit" id="submitOpportunityButton" class="px-5 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                Add Opportunity
                            </button>
                        </div>
                    </form>

                    <!-- Opportunity List -->
                    <div id="opportunityExistingListView" class="mt-8 bg-white p-6 rounded-lg shadow-md overflow-x-auto">
                        <h3 class="text-2xl font-semibold text-gray-800 mb-4">Existing Opportunities</h3>
                        <div class="data-grid-header grid grid-cols-[100px_minmax(120px,_1.5fr)_1fr_0.8fr_1fr_1.2fr_1.5fr_1.5fr_1fr]">
                            <div class="px-2 py-1">ID</div>
                            <div class="px-2 py-1">Name</div>
                            <div class="px-2 py-1">Customer</div>
                            <div class="px-2 py-1">Amount</div>
                            <div class="px-2 py-1">Stage</div>
                            <div class="px-2 py-1 hidden sm:block">Start Date</div>
                            <div class="px-2 py-1 hidden md:block">Close Date</div>
                            <div class="px-2 py-1 hidden lg:block">Event Type</div>
                            <div class="px-2 py-1 text-right">Actions</div>
                        </div>
                        <div id="opportunityList" class="divide-y divide-gray-100">
                            <!-- Opportunity rows will be dynamically inserted here -->
                            <p class="text-gray-500 text-center col-span-full py-4">Loading opportunities...</p>
                        </div>
                    </div>
                </div>

                <!-- Right Panel: Opportunity Summary & Linked Objects (Hidden by default, shown on edit) -->
                <div id="opportunity-right-panel" class="opportunity-panel w-full md:w-3/10 hidden-panel">
                    <div id="opportunitySummaryCard" class="bg-blue-100 p-6 rounded-lg shadow-md mb-6 cursor-pointer hover:shadow-lg transition-shadow duration-200">
                        <h3 class="text-xl font-bold text-blue-800 mb-2">Opportunity Summary</h3>
                        <p class="text-gray-700 text-sm"><strong class="text-blue-600">ID:</strong> <span id="summaryOpportunityId" class="font-mono"></span></p>
                        <p class="text-gray-700 text-sm"><strong class="text-blue-600">Name:</strong> <span id="summaryOpportunityName"></span></p>
                        <p class="text-gray-700 text-sm"><strong class="text-blue-600">Customer:</strong> <span id="summaryOpportunityCustomer"></span></p>
                        <p class="text-gray-700 text-sm"><strong class="text-blue-600">Stage:</strong> <span id="summaryOpportunityStage"></span></p>
                        <p class="text-gray-700 text-sm"><strong class="text-blue-600">Amount:</strong> <span id="summaryOpportunityAmount"></span></p>
                        <p class="text-xs text-blue-500 mt-2">Click to expand form view</p>
                    </div>

                    <!-- Linked Objects Accordion Container -->
                    <div id="linkedObjectsAccordion" class="hidden">
                        <!-- Contacts Accordion -->
                        <div class="mb-4 rounded-lg shadow-md bg-white">
                            <div id="contactsAccordionHeader" class="accordion-header">
                                Contacts
                                <i class="fas fa-chevron-down transform transition-transform duration-300"></i>
                            </div>
                            <div class="accordion-content">
                                <form id="opportunityContactForm" class="p-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <h4 class="text-lg font-semibold text-gray-800 mb-3 sm:col-span-2">Add/Edit Contact</h4>
                                    <div id="contactIdDisplayGroup" class="mb-3 sm:col-span-2 hidden">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Contact ID:</label>
                                        <span id="contactIdDisplay" class="text-md font-mono text-gray-700"></span>
                                    </div>
                                    <div>
                                        <label for="contactFirstName" class="block text-sm font-medium text-gray-700">First Name <span class="text-red-500">*</span></label>
                                        <input type="text" id="contactFirstName" required class="form-input-style">
                                    </div>
                                    <div>
                                        <label for="contactLastName" class="block text-sm font-medium text-gray-700">Last Name <span class="text-red-500">*</span></label>
                                        <input type="text" id="contactLastName" required class="form-input-style">
                                    </div>
                                    <div>
                                        <label for="contactEmail" class="block text-sm font-medium text-gray-700">Email <span class="text-red-500">*</span></label>
                                        <input type="email" id="contactEmail" required class="form-input-style">
                                    </div>
                                    <div>
                                        <label for="contactPhone" class="block text-sm font-medium text-gray-700">Phone <span class="text-red-500">*</span></label>
                                        <input type="tel" id="contactPhone" required class="form-input-style">
                                    </div>
                                    <div class="sm:col-span-2">
                                        <label for="contactRole" class="block text-sm font-medium text-gray-700">Role <span class="text-red-500">*</span></label>
                                        <input type="text" id="contactRole" required class="form-input-style">
                                    </div>
                                    <div class="sm:col-span-2 flex justify-end space-x-2">
                                        <button type="button" id="resetOpportunityContactFormButton" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">Reset</button>
                                        <button type="submit" id="submitOpportunityContactButton" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">Add Contact</button>
                                    </div>
                                </form>
                                <div class="p-4 bg-gray-50 rounded-b-lg mt-4">
                                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Linked Contacts</h4>
                                    <div class="data-grid-header grid grid-cols-[100px_1fr_1fr_1fr_1.2fr_1fr]">
                                        <div class="px-2 py-1">ID</div>
                                        <div class="px-2 py-1">Name</div>
                                        <div class="px-2 py-1">Email</div>
                                        <div class="px-2 py-1 hidden sm:block">Phone</div>
                                        <div class="px-2 py-1 hidden md:block">Role</div>
                                        <div class="px-2 py-1 text-right">Actions</div>
                                    </div>
                                    <div id="opportunityContactList" class="divide-y divide-gray-100">
                                        <p class="text-gray-500 text-center col-span-full py-4">No contacts added for this opportunity.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Lines Accordion (Stub) -->
                        <div class="mb-4 rounded-lg shadow-md bg-white">
                            <div id="linesAccordionHeader" class="accordion-header">
                                Lines
                                <i class="fas fa-chevron-down transform transition-transform duration-300"></i>
                            </div>
                            <div class="accordion-content">
                                <form id="opportunityLineForm" class="p-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <h4 class="text-lg font-semibold text-gray-800 mb-3 sm:col-span-2">Add/Edit Opportunity Line</h4>
                                    <div id="optyLineIdDisplayGroup" class="mb-3 sm:col-span-2 hidden">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Line ID:</label>
                                        <span id="optyLineIdDisplay" class="text-md font-mono text-gray-700"></span>
                                    </div>
                                    <div class="sm:col-span-2">
                                        <label for="lineServiceDescription" class="block text-sm font-medium text-gray-700">Service Description <span class="text-red-500">*</span></label>
                                        <input type="text" id="lineServiceDescription" required class="form-input-style">
                                    </div>
                                    <div>
                                        <label for="lineUnitPrice" class="block text-sm font-medium text-gray-700">Unit Price <span class="text-red-500">*</span></label>
                                        <input type="number" id="lineUnitPrice" required min="0" step="0.01" class="form-input-style">
                                    </div>
                                    <div>
                                        <label for="lineQuantity" class="block text-sm font-medium text-gray-700">Quantity <span class="text-red-500">*</span></label>
                                        <input type="number" id="lineQuantity" required min="1" step="1" class="form-input-style">
                                    </div>
                                    <div>
                                        <label for="lineDiscount" class="block text-sm font-medium text-gray-700">Discount (%)</label>
                                        <input type="number" id="lineDiscount" min="0" max="100" step="0.01" class="form-input-style">
                                    </div>
                                    <div>
                                        <label for="lineNetPrice" class="block text-sm font-medium text-gray-700">Net Price</label>
                                        <input type="text" id="lineNetPrice" readonly class="form-input-style bg-gray-100">
                                    </div>
                                    <div class="sm:col-span-2">
                                        <label for="lineStatus" class="block text-sm font-medium text-gray-700">Status <span class="text-red-500">*</span></label>
                                        <select id="lineStatus" required class="form-input-style">
                                            <option value="">Select Status</option>
                                            <option value="Active">Active</option>
                                            <option value="Cancelled">Cancelled</option>
                                            <option value="Completed">Completed</option>
                                        </select>
                                    </div>
                                    <div class="sm:col-span-2 flex justify-end space-x-2">
                                        <button type="button" id="resetOpportunityLineFormButton" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">Reset</button>
                                        <button type="submit" id="submitOpportunityLineButton" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">Add Line</button>
                                    </div>
                                </form>
                                <div class="p-4 bg-gray-50 rounded-b-lg mt-4">
                                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Linked Lines</h4>
                                    <div class="data-grid-header grid grid-cols-[100px_1.5fr_0.8fr_0.5fr_0.8fr_0.8fr_1fr]">
                                        <div class="px-2 py-1">ID</div>
                                        <div class="px-2 py-1">Description</div>
                                        <div class="px-2 py-1">Unit Price</div>
                                        <div class="px-2 py-1">Qty</div>
                                        <div class="px-2 py-1">Disc.</div>
                                        <div class="px-2 py-1">Net Price</div>
                                        <div class="px-2 py-1 text-right">Actions</div>
                                    </div>
                                    <div id="opportunityLineList" class="divide-y divide-gray-100">
                                        <p class="text-gray-500 text-center col-span-full py-4">No opportunity lines added for this opportunity.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quotes Accordion (Stub) -->
                        <div class="mb-4 rounded-lg shadow-md bg-white">
                            <div id="quotesAccordionHeader" class="accordion-header">
                                Quotes
                                <i class="fas fa-chevron-down transform transition-transform duration-300"></i>
                            </div>
                            <div class="accordion-content">
                                <form id="quoteForm" class="p-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <h4 class="text-lg font-semibold text-gray-800 mb-3 sm:col-span-2">Add/Edit Quote</h4>
                                    <div id="quoteIdDisplayGroup" class="mb-3 sm:col-span-2 hidden">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Quote ID:</label>
                                        <span id="quoteIdDisplay" class="text-md font-mono text-gray-700"></span>
                                    </div>
                                    <div class="sm:col-span-2">
                                        <label for="quoteName" class="block text-sm font-medium text-gray-700">Quote Name <span class="text-red-500">*</span></label>
                                        <input type="text" id="quoteName" required class="form-input-style">
                                    </div>
                                    <div class="sm:col-span-2">
                                        <label for="quoteDescription" class="block text-sm font-medium text-gray-700">Description</label>
                                        <textarea id="quoteDescription" rows="2" class="form-input-style"></textarea>
                                    </div>
                                    <div>
                                        <label for="quoteCustomer" class="block text-sm font-medium text-gray-700">Customer</label>
                                        <select id="quoteCustomer" disabled class="form-input-style bg-gray-100">
                                            <option value="">Auto-filled from Opportunity</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="quoteStartDate" class="block text-sm font-medium text-gray-700">Start Date <span class="text-red-500">*</span></label>
                                        <input type="date" id="quoteStartDate" required class="form-input-style">
                                    </div>
                                    <div>
                                        <label for="quoteExpireDate" class="block text-sm font-medium text-gray-700">Expire Date <span class="text-red-500">*</span></label>
                                        <input type="date" id="quoteExpireDate" required class="form-input-style">
                                    </div>
                                    <div>
                                        <label for="quoteStatus" class="block text-sm font-medium text-gray-700">Status <span class="text-red-500">*</span></label>
                                        <select id="quoteStatus" required class="form-input-style">
                                            <option value="">Select Status</option>
                                            <option value="Draft">Draft</option>
                                            <option value="Sent">Sent</option>
                                            <option value="Accepted">Accepted</option>
                                            <option value="Rejected">Rejected</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="quoteNetListAmount" class="block text-sm font-medium text-gray-700">Net List Amount</label>
                                        <input type="number" id="quoteNetListAmount" min="0" step="0.01" class="form-input-style">
                                    </div>
                                    <div>
                                        <label for="quoteNetDiscount" class="block text-sm font-medium text-gray-700">Net Discount</label>
                                        <input type="number" id="quoteNetDiscount" min="0" step="0.01" class="form-input-style">
                                    </div>
                                    <div>
                                        <label for="quoteNetAmount" class="block text-sm font-medium text-gray-700">Net Amount</label>
                                        <input type="text" id="quoteNetAmount" readonly class="form-input-style bg-gray-100">
                                    </div>
                                    <div>
                                        <label for="quoteCurrency" class="block text-sm font-medium text-gray-700">Currency <span class="text-red-500">*</span></label>
                                        <select id="quoteCurrency" required class="form-input-style">
                                            <option value="">Select Currency</option>
                                            <!-- Currencies will be populated by JS -->
                                        </select>
                                    </div>
                                    <div class="sm:col-span-2 flex items-center mt-2">
                                        <input type="checkbox" id="quoteIsFinal" class="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500">
                                        <label for="quoteIsFinal" class="ml-2 block text-sm font-medium text-gray-700">Is Final?</label>
                                    </div>
                                    <div class="sm:col-span-2 flex justify-end space-x-2">
                                        <button type="button" id="resetQuoteFormButton" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">Reset</button>
                                        <button type="submit" id="submitQuoteButton" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">Add Quote</button>
                                    </div>
                                </form>
                                <div class="p-4 bg-gray-50 rounded-b-lg mt-4">
                                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Linked Quotes</h4>
                                    <div class="data-grid-header grid grid-cols-[100px_1.5fr_1fr_0.8fr_0.8fr_1fr]">
                                        <div class="px-2 py-1">ID</div>
                                        <div class="px-2 py-1">Name</div>
                                        <div class="px-2 py-1">Status</div>
                                        <div class="px-2 py-1">Amount</div>
                                        <div class="px-2 py-1 hidden sm:block">Expire Date</div>
                                        <div class="px-2 py-1 text-right">Actions</div>
                                    </div>
                                    <div id="quoteList" class="divide-y divide-gray-100">
                                        <p class="text-gray-500 text-center col-span-full py-4">No quotes added for this opportunity.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>


        <!-- Events Section -->
        <section id="events-section" class="hidden bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-3xl font-bold text-blue-700 mb-6">Event Calendar</h2>
            <p class="text-gray-600">Upcoming events will be displayed here.</p>
            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Placeholder for events -->
                <div class="bg-blue-50 p-4 rounded-md shadow">
                    <h4 class="font-semibold text-blue-800">Client Workshop</h4>
                    <p class="text-sm text-gray-700">Date: 2024-07-15</p>
                    <p class="text-sm text-gray-700">Location: Virtual</p>
                </div>
                <div class="bg-blue-50 p-4 rounded-md shadow">
                    <h4 class="font-semibold text-blue-800">Product Launch Party</h4>
                    <p class="text-sm text-gray-700">Date: 2024-08-01</p>
                    <p class="text-sm text-gray-700">Location: Downtown Venue</p>
                </div>
                <div class="bg-blue-50 p-4 rounded-md shadow">
                    <h4 class="font-semibold text-blue-800">Team Building Day</h4>
                    <p class="text-sm text-gray-700">Date: 2024-09-10</p>
                    <p class="text-sm text-gray-700">Location: City Park</p>
                </div>
            </div>
        </section>

        <!-- Admin Country Mapping Section -->
        <section id="admin-country-mapping-section" class="hidden bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-3xl font-bold text-blue-700 mb-6">Admin: Country and State Mapping</h2>
            <p class="text-gray-600 mb-4">Upload or update country and state data for dropdowns. Use the specified CSV formats.</p>

            <form id="countryMappingForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="mb-4 md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Load Type:</label>
                    <div class="flex items-center space-x-4">
                        <input type="radio" id="fullLoad" name="loadType" value="full" checked class="form-radio h-4 w-4 text-blue-600">
                        <label for="fullLoad" class="text-sm font-medium text-gray-700">Full Load (Replace All)</label>
                        <input type="radio" id="incrementalLoad" name="loadType" value="incremental" class="form-radio h-4 w-4 text-blue-600">
                        <label for="incrementalLoad" class="text-sm font-medium text-gray-700">Incremental Load (Merge existing, Add new)</label>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Full load will overwrite all existing data. Incremental load will update/add based on country code.</p>
                </div>

                <div class="mb-4">
                    <label for="adminCountriesInput" class="block text-sm font-medium text-gray-700 mb-1">Countries CSV (<code class="font-mono">Name,Code</code> per line)</label>
                    <textarea id="adminCountriesInput" rows="10" placeholder="e.g.,
United States,US
Canada,CA
Mexico,MX" class="form-input-style font-mono"></textarea>
                    <p class="text-xs text-gray-500 mt-1">Provide country Name and 2-letter Code. Each country on a new line.</p>
                </div>

                <div class="mb-4">
                    <label for="adminCountryStateMapInput" class="block text-sm font-medium text-gray-700 mb-1">Country-State/Province Map (<code class="font-mono">Code:State1,State2</code> per line)</label>
                    <textarea id="adminCountryStateMapInput" rows="10" placeholder="e.g.,
US:AL,AK,AZ,AR
CA:AB,BC,MB
MX:AGU,BCN,BJS" class="form-input-style font-mono"></textarea>
                    <p class="text-xs text-gray-500 mt-1">Provide Country Code followed by a colon and comma-separated states/provinces. Each country's states on a new line.</p>
                </div>

                <div id="adminMessage" class="md:col-span-2 message hidden"></div>

                <div class="md:col-span-2 flex justify-end">
                    <button type="submit" id="uploadAdminDataButton" class="px-5 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Upload Data to Firestore
                    </button>
                </div>
            </form>
        </section>

        <!-- Admin Currency Management Section (NEW) -->
        <section id="currency-management-section" class="hidden bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-3xl font-bold text-blue-700 mb-6">Admin: Currency Management</h2>
            <p class="text-gray-600 mb-4">Add, edit, or delete currencies used in the application. Provide data in the specified CSV format.</p>

            <!-- Currency Form -->
            <form id="currencyForm" class="grid grid-cols-1 gap-6 mb-8 p-6 bg-gray-50 rounded-lg shadow-inner">
                <h3 id="currencyFormTitle" class="text-2xl font-semibold text-gray-800 mb-4">Add New Currency</h3>

                <div id="currencyCodeDisplayGroup" class="mb-4 hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Currency Code (ISO 4217):</label>
                    <span id="currencyCodeDisplay" class="text-lg font-mono text-blue-700"></span>
                </div>

                <div class="mb-4">
                    <label for="adminCurrenciesInput" class="block text-sm font-medium text-gray-700 mb-1">Currencies CSV (<code class="font-mono">Code,Name,Symbol,NativeSymbol</code> per line)</label>
                    <textarea id="adminCurrenciesInput" rows="5" placeholder="e.g.,
USD,United States Dollar,$,$
EUR,Euro,,
GBP,British Pound,," class="form-input-style font-mono"></textarea>
                    <p class="text-xs text-gray-500 mt-1">Provide ISO 4217 Code (e.g., USD), Currency Name, Symbol, and Native Symbol. Each currency on a new line. For editing, provide only one line matching the currency's code.</p>
                </div>

                <div id="adminCurrencyMessageDiv" class="message hidden"></div>

                <div class="flex justify-end space-x-3">
                    <button type="button" id="resetCurrencyFormButton" class="px-5 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Reset
                    </button>
                    <button type="submit" id="submitCurrencyButton" class="px-5 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Upload Currencies to Firestore
                    </button>
                </div>
            </form>

            <!-- Currency List -->
            <div class="mt-8 bg-white p-6 rounded-lg shadow-md overflow-x-auto">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Existing Currencies</h3>
                <div class="data-grid-header grid grid-cols-[0.8fr_1.5fr_0.8fr_0.8fr_1fr]">
                    <div class="px-2 py-1">Code</div>
                    <div class="px-2 py-1">Name</div>
                    <div class="px-2 py-1">Symbol</div>
                    <div class="px-2 py-1">Native Symbol</div>
                    <div class="px-2 py-1 text-right">Actions</div>
                </div>
                <div id="currencyList" class="divide-y divide-gray-100">
                    <!-- Currency rows will be dynamically inserted here -->
                    <p class="text-gray-500 text-center col-span-full py-4">Loading currencies...</p>
                </div>
            </div>
        </section>


        <!-- Admin Users Management Section -->
        <section id="users-management-section" class="hidden bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-3xl font-bold text-blue-700 mb-6">Admin: User Management</h2>
            <p class="text-gray-600 mb-4">Create or update user profiles. For new users, ensure they are first created in Firebase Authentication, then provide their Firebase User ID (UID) here.</p>

            <!-- User Form -->
            <form id="userForm" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 p-6 bg-gray-50 rounded-lg shadow-inner">
                <h3 id="userFormTitle" class="text-2xl font-semibold text-gray-800 mb-4 md:col-span-2">Add New User Profile</h3>

                <div id="userIdDisplayGroup" class="mb-4 md:col-span-2">
                    <label for="userIdDisplayInput" class="block text-sm font-medium text-gray-700 mb-1">Firebase User ID (UID) <span class="text-red-500">*</span></label>
                    <input type="text" id="userIdDisplayInput" name="userId" required placeholder="Enter Firebase User UID (e.g., aBcDeFg123xyz)" class="form-input-style font-mono">
                    <p class="text-xs text-gray-500 mt-1">This is the unique ID from Firebase Authentication.</p>
                </div>

                <div class="mb-4">
                    <label for="userName" class="block text-sm font-medium text-gray-700 mb-1">User Name (Gmail Email) <span class="text-red-500">*</span></label>
                    <input type="email" id="userName" name="userName" required placeholder="user@gmail.com" class="form-input-style">
                    <p class="text-xs text-gray-500 mt-1">Must be a valid Gmail address.</p>
                </div>
                <div class="mb-4">
                    <label for="userFirstName" class="block text-sm font-medium text-gray-700 mb-1">First Name <span class="text-red-500">*</span></label>
                    <input type="text" id="userFirstName" name="firstName" required class="form-input-style">
                </div>
                <div class="mb-4">
                    <label for="userLastName" class="block text-sm font-medium text-gray-700 mb-1">Last Name <span class="text-red-500">*</span></label>
                    <input type="text" id="userLastName" name="lastName" required class="form-input-style">
                </div>
                <div class="mb-4">
                    <label for="userEmail" class="block text-sm font-medium text-gray-700 mb-1">Contact Email <span class="text-red-500">*</span></label>
                    <input type="email" id="userEmail" name="email" required class="form-input-style">
                </div>
                <div class="mb-4">
                    <label for="userPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone <span class="text-red-500">*</span></label>
                    <input type="tel" id="userPhone" name="phone" required class="form-input-style">
                </div>
                <div class="mb-4">
                    <label for="userRole" class="block text-sm font-medium text-gray-700 mb-1">Role <span class="text-red-500">*</span></label>
                    <select id="userRole" name="role" required class="form-input-style">
                        <option value="User">User</option>
                        <option value="Admin">Admin</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1">Setting role to 'Admin' will grant full system access.</p>
                </div>
                <div class="mb-4 md:col-span-2">
                    <label for="userSkills" class="block text-sm font-medium text-gray-700 mb-1">Skills (comma-separated) <span class="text-red-500">*</span></label>
                    <input type="text" id="userSkills" name="skills" required placeholder="e.g., Photography, Editing, Marketing" class="form-input-style">
                    <p class="text-xs text-gray-500 mt-1">Enter skills separated by commas.</p>
                </div>


                <div class="md:col-span-2 flex justify-end space-x-3">
                    <button type="button" id="resetUserFormButton" class="px-5 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Reset
                    </button>
                    <button type="submit" id="submitUserButton" class="px-5 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Create User Profile
                    </button>
                </div>
            </form>

            <!-- User List -->
            <div class="mt-8 bg-white p-6 rounded-lg shadow-md overflow-x-auto">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Existing User Profiles</h3>
                <div class="data-grid-header grid grid-cols-[100px_minmax(120px,_1.2fr)_1.5fr_1fr_1fr_1.5fr]">
                    <div class="px-2 py-1">UID</div>
                    <div class="px-2 py-1">User Name</div>
                    <div class="px-2 py-1">Contact Email</div>
                    <div class="px-2 py-1 hidden sm:block">Role</div>
                    <div class="px-2 py-1 hidden md:block">Skills</div>
                    <div class="px-2 py-1 text-right">Actions</div>
                </div>
                <div id="userList" class="divide-y divide-gray-100">
                    <!-- User rows will be dynamically inserted here -->
                    <p class="text-gray-500 text-center col-span-full py-4">Loading users...</p>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-blue-800 text-white p-4 text-center text-sm">
        <p>&copy; 2024 ShutterSync CRM. All rights reserved.</p>
    </footer>

    <script type="module" src="js/script.js"></script>
</body>
</html>
