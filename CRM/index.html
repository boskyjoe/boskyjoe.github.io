<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShutterSync CRM</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons (Hamburger, etc.) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- External Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-gray-100 font-inter">
    <header class="header p-4">
        <div class="container mx-auto flex justify-between items-center">
            <!-- Logo -->
            <div class="text-2xl font-bold text-gray-800">ShutterSync CRM</div>

            <!-- Desktop Navigation -->
            <nav class="hidden md:flex items-center space-x-4">
                <a href="#" class="nav-link" data-section="home-section">Home</a>
                <a href="#" class="nav-link" data-section="customers-section">Customers</a>
                <a href="#" class="nav-link" data-section="opportunities-section">Opportunities</a>
                <a href="#" class="nav-link" data-section="events-section">Events</a>

                <!-- Admin Dropdown for Desktop -->
                <li id="desktopAdminMenu" class="relative group hidden"> <!-- Hidden by default, shown by JS if isAdmin -->
                    <a href="#" id="desktopAdminMenuToggle" class="nav-link flex items-center">
                        Admin
                        <svg class="ml-1 w-4 h-4 transform group-[.active]:rotate-180 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </a>
                    <ul id="desktopAdminSubMenu" class="absolute bg-white shadow-lg rounded-md mt-2 py-2 w-48 z-10">
                        <li><a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 nav-link" data-section="admin-country-mapping-section">Country Mapping</a></li>
                        <li><a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 nav-link" data-section="currency-management-section">Currencies</a></li>
                        <li><a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 nav-link" data-section="users-management-section">Users</a></li>
                        <li><a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 nav-link" data-section="price-book-management-section">Price Books</a></li>
                    </ul>
                </li>
            </nav>

            <!-- Right-aligned Auth and User Info (Desktop) -->
            <div class="hidden md:flex items-center space-x-4">
                <button id="navGoogleLoginButton" class="btn-primary text-sm flex items-center hidden">
                    <i class="fab fa-google mr-2"></i>Sign In with Google
                </button>
                <div id="userIdDisplay" class="text-gray-700 text-sm font-medium mr-4 hidden"></div>
                <button id="logoutButton" class="btn-secondary text-sm hidden">Logout</button>
            </div>

            <!-- Mobile Hamburger Menu Button -->
            <div class="md:hidden">
                <button id="mobileMenuButton" class="text-gray-700 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-md p-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Mobile Navigation (hidden by default) -->
        <nav id="mobileMenu" class="md:hidden bg-white shadow-lg pb-4">
            <div class="flex flex-col items-start px-2 pt-2 pb-3 space-y-1">
                <a href="#" class="nav-link" data-section="home-section">Home</a>
                <a href="#" class="nav-link" data-section="customers-section">Customers</a>
                <a href="#" class="nav-link" data-section="opportunities-section">Opportunities</a>
                <a href="#" class="nav-link" data-section="events-section">Events</a>

                <!-- Admin Dropdown for Mobile -->
                <li id="mobileAdminMenu" class="w-full relative hidden"> <!-- Hidden by default, shown by JS if isAdmin -->
                    <a href="#" id="mobileAdminMenuToggle" class="nav-link flex items-center justify-between w-full">
                        Admin
                        <svg class="ml-1 w-4 h-4 transform transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </a>
                    <ul id="mobileAdminSubMenu" class="mobile-submenu hidden flex flex-col w-full">
                        <li><a href="#" class="nav-link" data-section="admin-country-mapping-section">Country Mapping</a></li>
                        <li><a href="#" class="nav-link" data-section="currency-management-section">Currencies</a></li>
                        <li><a href="#" class="nav-link" data-section="users-management-section">Users</a></li>
                        <li><a href="#" class="nav-link" data-section="price-book-management-section">Price Books</a></li>
                    </ul>
                </li>
            </div>
            <!-- Mobile Auth Info -->
            <div class="px-2 pt-2 border-t border-gray-200 flex flex-col items-center w-full">
                <div id="mobileUserIdDisplay" class="text-gray-700 text-sm font-medium mb-2 hidden"></div>
                <button id="mobileLogoutButton" class="btn-secondary w-full hidden">Logout</button>
            </div>
        </nav>
    </header>

    <main class="flex-1">
        <!-- Home Section -->
        <section id="home-section" class="container mx-auto p-6 hidden">
            <div class="text-center py-20 bg-white rounded-lg shadow-md">
                <h1 class="text-5xl font-extrabold text-gray-900 mb-4">Welcome to ShutterSync CRM</h1>
                <p class="text-xl text-gray-600 mb-8">Your all-in-one solution for managing customers, opportunities, and events with ease.</p>
                <p id="homeSignInMessage" class="text-lg text-gray-700 mb-8 hidden">Please sign in to access CRM features.</p>
                <button id="googleLoginButton" class="btn-primary text-lg flex items-center mx-auto">
                    <i class="fab fa-google mr-3"></i>Get Started with Google
                </button>
            </div>
        </section>

        <!-- Customers Section -->
        <section id="customers-section" class="container mx-auto p-6 hidden">
            <h2 class="section-title">Customer Management</h2>
            <div class="card mb-6">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4" id="customerFormTitle">Add New Customer</h3>
                <form id="customerForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Customer Type -->
                    <div>
                        <label for="customerType" class="block text-sm font-medium text-gray-700 mb-1">Customer Type</label>
                        <select id="customerType" class="form-select" required>
                            <option value="Individual">Individual</option>
                            <option value="Company">Company</option>
                        </select>
                    </div>

                    <!-- Individual Fields -->
                    <div id="individualFields" class="grid grid-cols-1 sm:grid-cols-2 gap-6 md:col-span-2">
                        <div>
                            <label for="customerFirstName" class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                            <input type="text" id="customerFirstName" class="form-input" placeholder="John">
                        </div>
                        <div>
                            <label for="customerLastName" class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                            <input type="text" id="customerLastName" class="form-input" placeholder="Doe">
                        </div>
                    </div>

                    <!-- Company Name Field -->
                    <div id="companyNameField" class="md:col-span-2 hidden">
                        <label for="customerCompanyName" class="block text-sm font-medium text-gray-700 mb-1">Company Name</label>
                        <input type="text" id="customerCompanyName" class="form-input" placeholder="Acme Corp">
                    </div>

                    <!-- Common Fields -->
                    <div>
                        <label for="customerEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="customerEmail" class="form-input" placeholder="john.doe@example.com" required>
                    </div>
                    <div>
                        <label for="customerPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                        <input type="tel" id="customerPhone" class="form-input" placeholder="(123) 456-7890" required>
                    </div>

                    <!-- Address Fields -->
                    <div class="md:col-span-2 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div>
                            <label for="customerCountry" class="block text-sm font-medium text-gray-700 mb-1">Country</label>
                            <select id="customerCountry" class="form-select" required>
                                <!-- Options populated by JS -->
                            </select>
                        </div>
                        <div>
                            <label for="customerAddress" class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                            <input type="text" id="customerAddress" class="form-input" placeholder="123 Main St" required>
                        </div>
                        <div>
                            <label for="customerCity" class="block text-sm font-medium text-gray-700 mb-1">City</label>
                            <input type="text" id="customerCity" class="form-input" placeholder="Anytown" required>
                        </div>
                        <div>
                            <label for="customerState" class="block text-sm font-medium text-gray-700 mb-1">State/Province</label>
                            <select id="customerState" class="form-select" required disabled>
                                <!-- Options populated by JS based on country -->
                            </select>
                        </div>
                        <div>
                            <label for="customerZipCode" class="block text-sm font-medium text-gray-700 mb-1">Zip Code</label>
                            <input type="text" id="customerZipCode" class="form-input" placeholder="12345" required>
                        </div>
                    </div>
                    <div id="addressValidationMessage" class="md:col-span-2 text-red-600 text-sm hidden"></div>


                    <!-- Industry Fields (Conditional) -->
                    <div id="individualIndustryGroup" class="md:col-span-2">
                        <label for="customerIndustryInput" class="block text-sm font-medium text-gray-700 mb-1">Industry</label>
                        <input type="text" id="customerIndustryInput" class="form-input" placeholder="Retail">
                    </div>
                    <div id="companyIndustryGroup" class="md:col-span-2 hidden">
                        <label for="customerIndustrySelect" class="block text-sm font-medium text-gray-700 mb-1">Industry</label>
                        <select id="customerIndustrySelect" class="form-select">
                            <option value="">Select Industry</option>
                            <option value="Technology">Technology</option>
                            <option value="Healthcare">Healthcare</option>
                            <option value="Finance">Finance</option>
                            <option value="Education">Education</option>
                            <option value="Manufacturing">Manufacturing</option>
                            <option value="Retail">Retail</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <!-- NEW: Customer Source Field -->
                    <div>
                        <label for="customerSource" class="block text-sm font-medium text-gray-700 mb-1">Customer Source</label>
                        <select id="customerSource" class="form-select">
                            <option value="">Select Source</option>
                            <option value="Website">Website</option>
                            <option value="Referral">Referral</option>
                            <option value="Social Media">Social Media</option>
                            <option value="Advertisement">Advertisement</option>
                            <option value="Event">Event</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <!-- NEW: Active (Y/N) Field -->
                    <div>
                        <label for="customerActive" class="block text-sm font-medium text-gray-700 mb-1">Active</label>
                        <select id="customerActive" class="form-select">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>

                    <div class="md:col-span-2">
                        <label for="customerSince" class="block text-sm font-medium text-gray-700 mb-1">Customer Since</label>
                        <input type="date" id="customerSince" class="form-input" required>
                    </div>
                    <div class="md:col-span-2">
                        <label for="customerDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea id="customerDescription" rows="3" class="form-textarea" placeholder="Notes about the customer..."></textarea>
                    </div>

                    <!-- Customer ID Display (hidden by default) -->
                    <div id="customerIdDisplayGroup" class="md:col-span-2 bg-gray-50 p-3 rounded-md text-sm text-gray-600 hidden">
                        <strong>Customer ID:</strong> <span id="customerIdDisplay"></span>
                    </div>

                    <div class="md:col-span-2 flex justify-end space-x-3 mt-4">
                        <button type="button" id="resetCustomerFormButton" class="btn-secondary">Reset</button>
                        <button type="submit" id="submitCustomerButton" class="btn-primary">Add Customer</button>
                    </div>
                </form>
            </div>

            <h3 class="text-2xl font-semibold text-gray-800 mb-4">Existing Customers</h3>
            <div class="card p-0 overflow-hidden">
                <div class="data-grid-header">
                    <div>Customer ID</div>
                    <div>Name</div>
                    <div>Email</div>
                    <div class="hidden md:block">Phone</div>
                    <div class="hidden lg:block">Address</div>
                    <div class="hidden lg:block">Industry</div>
                    <div class="hidden sm:block">Since</div>
                    <div class="hidden md:block">Source</div>
                    <div class="hidden md:block">Active</div>
                    <div class="text-right">Actions</div>
                </div>
                <div id="customerList" class="data-grid-body">
                    <p class="text-gray-500 text-center py-4 col-span-full">Loading customers...</p>
                </div>
            </div>
        </section>

        <!-- Opportunities Section (Updated for 2-panel layout) -->
        <section id="opportunities-section" class="container mx-auto p-6 hidden">
            <h2 class="section-title">Opportunity Management</h2>
            <div id="opportunity-view-container" class="flex flex-col md:flex-row gap-6">

                <!-- Left Panel: Opportunity Form & List -->
                <div id="opportunity-left-panel" class="opportunity-panel bg-white rounded-lg shadow-md p-6 w-full md:w-full">
                    <div id="opportunity-full-form-view">
                        <h3 class="text-2xl font-semibold text-gray-800 mb-4" id="opportunityFormTitle">Add New Opportunity</h3>
                        <form id="opportunityForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Opportunity ID Display (hidden by default) -->
                            <div id="opportunityIdDisplayGroup" class="md:col-span-2 bg-gray-50 p-3 rounded-md text-sm text-gray-600 hidden">
                                <strong>Opportunity ID:</strong> <span id="opportunityIdDisplay"></span>
                            </div>

                            <div>
                                <label for="opportunityCustomer" class="block text-sm font-medium text-gray-700 mb-1">Customer</label>
                                <select id="opportunityCustomer" class="form-select" required>
                                    <!-- Options populated by JS -->
                                </select>
                            </div>
                            <div>
                                <label for="opportunityName" class="block text-sm font-medium text-gray-700 mb-1">Opportunity Name</label>
                                <input type="text" id="opportunityName" class="form-input" placeholder="Project Alpha" required>
                            </div>
                            <div class="flex items-end">
                                <div class="flex-grow">
                                    <label for="opportunityAmount" class="block text-sm font-medium text-gray-700 mb-1">Amount</label>
                                    <input type="number" id="opportunityAmount" class="form-input" step="0.01" min="0" placeholder="1000.00" required>
                                </div>
                                <span id="currencySymbolDisplay" class="ml-2 text-gray-600 text-lg mb-1">$</span>
                            </div>
                            <div>
                                <label for="opportunityCurrency" class="block text-sm font-medium text-gray-700 mb-1">Currency</label>
                                <select id="opportunityCurrency" class="form-select" required>
                                    <!-- Options populated by JS -->
                                </select>
                            </div>
                            <div>
                                <label for="opportunityStage" class="block text-sm font-medium text-gray-700 mb-1">Stage</label>
                                <select id="opportunityStage" class="form-select" required>
                                    <option value="">Select Stage</option>
                                    <option value="New Lead">New Lead</option>
                                    <option value="Qualification">Qualification</option>
                                    <option value="Proposal">Proposal</option>
                                    <option value="Negotiation">Negotiation</option>
                                    <option value="Closed Won">Closed Won</option>
                                    <option value="Closed Lost">Closed Lost</option>
                                </select>
                            </div>
                            <div>
                                <label for="opportunityExpectedStartDate" class="block text-sm font-medium text-gray-700 mb-1">Expected Start Date</label>
                                <input type="date" id="opportunityExpectedStartDate" class="form-input" required>
                            </div>
                            <div>
                                <label for="opportunityExpectedCloseDate" class="block text-sm font-medium text-gray-700 mb-1">Expected Close Date</label>
                                <input type="date" id="opportunityExpectedCloseDate" class="form-input" required>
                            </div>
                            <div>
                                <label for="opportunityEventType" class="block text-sm font-medium text-gray-700 mb-1">Event Type</label>
                                <select id="opportunityEventType" class="form-select" required>
                                    <option value="">Select Event Type</option>
                                    <option value="Wedding">Wedding</option>
                                    <option value="Corporate Event">Corporate Event</option>
                                    <option value="Family Portrait">Family Portrait</option>
                                    <option value="Product Shoot">Product Shoot</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div>
                                <label for="opportunityEventLocationProposed" class="block text-sm font-medium text-gray-700 mb-1">Proposed Event Location</label>
                                <input type="text" id="opportunityEventLocationProposed" class="form-input" placeholder="Venue Name, City" required>
                            </div>
                            <div class="md:col-span-2">
                                <label for="opportunityServiceAddress" class="block text-sm font-medium text-gray-700 mb-1">Service Address</label>
                                <input type="text" id="opportunityServiceAddress" class="form-input" placeholder="e.g., 123 Main St, Anytown, CA 12345, USA" required>
                            </div>
                            <div class="md:col-span-2">
                                <label for="opportunityDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea id="opportunityDescription" rows="3" class="form-textarea" placeholder="Detailed notes about the opportunity..."></textarea>
                            </div>
                            <div class="md:col-span-2">
                                <label for="opportunityData" class="block text-sm font-medium text-gray-700 mb-1">Additional Opportunity Data (JSON)</label>
                                <i class="fas fa-info-circle text-gray-400 text-xs ml-1 group relative">
                                    <span class="tooltip-text">Enter additional data as a JSON object, e.g., {"client_priority": "high", "referral_source": "web"}. If not a valid JSON, it will be saved as plain text.</span>
                                </i>
                                <textarea id="opportunityData" rows="3" class="form-textarea" placeholder='{"key": "value", "another_key": 123}'></textarea>
                            </div>

                            <div class="md:col-span-2 flex justify-end space-x-3 mt-4">
                                <button type="button" id="resetOpportunityFormButton" class="btn-secondary">Reset</button>
                                <button type="submit" id="submitOpportunityButton" class="btn-primary">Add Opportunity</button>
                            </div>
                        </form>
                    </div>

                    <div id="opportunity-existing-list-view" class="mt-8">
                        <h3 class="text-2xl font-semibold text-gray-800 mb-4">Existing Opportunities</h3>
                        <div class="card p-0 overflow-hidden">
                            <div class="data-grid-header">
                                <div>ID</div>
                                <div>Name</div>
                                <div>Customer</div>
                                <div>Amount</div>
                                <div>Stage</div>
                                <div class="hidden sm:block">Start Date</div>
                                <div class="hidden md:block">Close Date</div>
                                <div class="hidden lg:block">Event Type</div>
                                <div class="text-right">Actions</div>
                            </div>
                            <div id="opportunityList" class="data-grid-body">
                                <p class="text-gray-500 text-center py-4 col-span-full">Loading opportunities...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Panel: Linked Objects Accordion -->
                <div id="opportunity-right-panel" class="opportunity-panel w-full md:w-3/10 hidden-panel">
                    <div id="linkedObjectsAccordion" class="hidden"> <!-- Hidden by default, shown when editing an opportunity -->
                        <h3 class="text-2xl font-semibold text-gray-800 mb-4 text-center">Related Section</h3>

                        <!-- Contacts Accordion -->
                        <div class="accordion-item mb-4">
                            <button class="accordion-header w-full" id="contactsAccordionHeader">
                                Opportunity Contacts
                                <svg class="accordion-icon w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </button>
                            <div class="accordion-content">
                                <!-- Contact Form -->
                                <h4 class="text-xl font-semibold text-gray-700 mb-3">Add/Edit Contact</h4>
                                <form id="opportunityContactForm" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                    <div id="contactIdDisplayGroup" class="md:col-span-2 bg-gray-50 p-2 rounded-md text-sm text-gray-600 hidden">
                                        <strong>Contact ID:</strong> <span id="contactIdDisplay"></span>
                                    </div>
                                    <div>
                                        <label for="contactFirstName" class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                                        <input type="text" id="contactFirstName" class="form-input" required>
                                    </div>
                                    <div>
                                        <label for="contactLastName" class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                                        <input type="text" id="contactLastName" class="form-input" required>
                                    </div>
                                    <div>
                                        <label for="contactEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                        <input type="email" id="contactEmail" class="form-input" required>
                                    </div>
                                    <div>
                                        <label for="contactPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                                        <input type="tel" id="contactPhone" class="form-input" required>
                                    </div>
                                    <div class="md:col-span-2">
                                        <label for="contactRole" class="block text-sm font-medium text-gray-700 mb-1">Role</label>
                                        <input type="text" id="contactRole" class="form-input" placeholder="Decision Maker, Technical Contact" required>
                                    </div>
                                    <div class="md:col-span-2 flex justify-end space-x-2 mt-2">
                                        <button type="button" id="resetOpportunityContactFormButton" class="btn-secondary text-xs px-3 py-1.5">Reset</button>
                                        <button type="submit" id="submitOpportunityContactButton" class="btn-primary text-xs px-3 py-1.5">Add Contact</button>
                                    </div>
                                </form>

                                <!-- Contact List -->
                                <h4 class="text-xl font-semibold text-gray-700 mb-3">Existing Contacts</h4>
                                <div class="card p-0 overflow-hidden mt-4">
                                    <div class="data-grid-header">
                                        <div>Contact ID</div>
                                        <div>Name</div>
                                        <div>Email</div>
                                        <div class="hidden sm:block">Phone</div>
                                        <div class="hidden md:block">Role</div>
                                        <div class="text-right">Actions</div>
                                    </div>
                                    <div id="opportunityContactList" class="data-grid-body">
                                        <p class="text-gray-500 text-center py-4 col-span-full">No contacts added for this opportunity.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Lines Accordion -->
                        <div class="accordion-item mb-4">
                            <button class="accordion-header w-full" id="linesAccordionHeader">
                                Opportunity Lines
                                <svg class="accordion-icon w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </button>
                            <div class="accordion-content">
                                <!-- Line Form -->
                                <h4 class="text-xl font-semibold text-gray-700 mb-3">Add/Edit Line Item</h4>
                                <form id="opportunityLineForm" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                    <div id="optyLineIdDisplayGroup" class="md:col-span-2 bg-gray-50 p-2 rounded-md text-sm text-gray-600 hidden">
                                        <strong>Line ID:</strong> <span id="optyLineIdDisplay"></span>
                                    </div>
                                    <div>
                                        <label for="lineServiceDescription" class="block text-sm font-medium text-gray-700 mb-1">Service Description</label>
                                        <input type="text" id="lineServiceDescription" class="form-input" required>
                                    </div>
                                    <div>
                                        <label for="lineUnitPrice" class="block text-sm font-medium text-gray-700 mb-1">Unit Price</label>
                                        <input type="number" id="lineUnitPrice" class="form-input" step="0.01" min="0" required>
                                    </div>
                                    <div>
                                        <label for="lineQuantity" class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
                                        <input type="number" id="lineQuantity" class="form-input" min="1" required>
                                    </div>
                                    <div>
                                        <label for="lineDiscount" class="block text-sm font-medium text-gray-700 mb-1">Discount (%)</label>
                                        <input type="number" id="lineDiscount" class="form-input" step="0.01" min="0" max="100" value="0">
                                    </div>
                                    <div>
                                        <label for="lineNetPrice" class="block text-sm font-medium text-gray-700 mb-1">Net Price</label>
                                        <input type="text" id="lineNetPrice" class="form-input bg-gray-100" readonly>
                                    </div>
                                    <div class="md:col-span-2">
                                        <label for="lineStatus" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                        <select id="lineStatus" class="form-select" required>
                                            <option value="Proposed">Proposed</option>
                                            <option value="Accepted">Accepted</option>
                                            <option value="Rejected">Rejected</option>
                                        </select>
                                    </div>
                                    <div class="md:col-span-2 flex justify-end space-x-2 mt-2">
                                        <button type="button" id="resetOpportunityLineFormButton" class="btn-secondary text-xs px-3 py-1.5">Reset</button>
                                        <button type="submit" id="submitOpportunityLineButton" class="btn-primary text-xs px-3 py-1.5">Add Line</button>
                                    </div>
                                </form>

                                <!-- Line List -->
                                <h4 class="text-xl font-semibold text-gray-700 mb-3">Existing Line Items</h4>
                                <div class="card p-0 overflow-hidden mt-4">
                                    <div class="data-grid-header">
                                        <div>Line ID</div>
                                        <div>Description</div>
                                        <div>Unit Price</div>
                                        <div>Qty</div>
                                        <div>Discount</div>
                                        <div>Net Price</div>
                                        <div class="text-right">Actions</div>
                                    </div>
                                    <div id="opportunityLineList" class="data-grid-body">
                                        <p class="text-gray-500 text-center py-4 col-span-full">No opportunity lines added for this opportunity.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quotes Accordion -->
                        <div class="accordion-item">
                            <button class="accordion-header w-full" id="quotesAccordionHeader">
                                Quotes
                                <svg class="accordion-icon w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </button>
                            <div class="accordion-content">
                                <!-- Quote Form -->
                                <h4 class="text-xl font-semibold text-gray-700 mb-3">Add/Edit Quote</h4>
                                <form id="quoteForm" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                    <div id="quoteIdDisplayGroup" class="md:col-span-2 bg-gray-50 p-2 rounded-md text-sm text-gray-600 hidden">
                                        <strong>Quote ID:</strong> <span id="quoteIdDisplay"></span>
                                    </div>
                                    <div>
                                        <label for="quoteName" class="block text-sm font-medium text-gray-700 mb-1">Quote Name</label>
                                        <input type="text" id="quoteName" class="form-input" required>
                                    </div>
                                    <div>
                                        <label for="quoteCustomer" class="block text-sm font-medium text-gray-700 mb-1">Customer</label>
                                        <select id="quoteCustomer" class="form-select" disabled>
                                            <option value="">Auto-filled from Opportunity</option>
                                        </select>
                                    </div>
                                    <div class="md:col-span-2">
                                        <label for="quoteDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                        <textarea id="quoteDescription" rows="2" class="form-textarea"></textarea>
                                    </div>
                                    <div>
                                        <label for="quoteStartDate" class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                                        <input type="date" id="quoteStartDate" class="form-input" required>
                                    </div>
                                    <div>
                                        <label for="quoteExpireDate" class="block text-sm font-medium text-gray-700 mb-1">Expire Date</label>
                                        <input type="date" id="quoteExpireDate" class="form-input" required>
                                    </div>
                                    <div>
                                        <label for="quoteStatus" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                        <select id="quoteStatus" class="form-select" required>
                                            <option value="Draft">Draft</option>
                                            <option value="Sent">Sent</option>
                                            <option value="Accepted">Accepted</option>
                                            <option value="Rejected">Rejected</option>
                                            <option value="Revised">Revised</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="quoteCurrency" class="block text-sm font-medium text-gray-700 mb-1">Currency</label>
                                        <select id="quoteCurrency" class="form-select" required>
                                            <!-- Options populated by JS -->
                                        </select>
                                    </div>
                                    <div>
                                        <label for="quoteNetListAmount" class="block text-sm font-medium text-gray-700 mb-1">Net List Amount</label>
                                        <input type="number" id="quoteNetListAmount" class="form-input" step="0.01" min="0">
                                    </div>
                                    <div>
                                        <label for="quoteNetDiscount" class="block text-sm font-medium text-gray-700 mb-1">Net Discount Amount</label>
                                        <input type="number" id="quoteNetDiscount" class="form-input" step="0.01" min="0">
                                    </div>
                                    <div>
                                        <label for="quoteNetAmount" class="block text-sm font-medium text-gray-700 mb-1">Net Amount</label>
                                        <input type="text" id="quoteNetAmount" class="form-input bg-gray-100" readonly>
                                    </div>
                                    <div class="flex items-center mt-4 md:col-span-2">
                                        <input type="checkbox" id="quoteIsFinal" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                        <label for="quoteIsFinal" class="ml-2 block text-sm text-gray-900">Is Final?</label>
                                    </div>
                                    <div class="md:col-span-2 flex justify-end space-x-2 mt-2">
                                        <button type="button" id="resetQuoteFormButton" class="btn-secondary text-xs px-3 py-1.5">Reset</button>
                                        <button type="submit" id="submitQuoteButton" class="btn-primary text-xs px-3 py-1.5">Add Quote</button>
                                    </div>
                                </form>

                                <!-- Quote List -->
                                <h4 class="text-xl font-semibold text-gray-700 mb-3">Existing Quotes</h4>
                                <div class="card p-0 overflow-hidden mt-4">
                                    <div class="data-grid-header">
                                        <div>Quote ID</div>
                                        <div>Name</div>
                                        <div>Status</div>
                                        <div>Net Amount</div>
                                        <div class="hidden sm:block">Expire Date</div>
                                        <div class="text-right">Actions</div>
                                    </div>
                                    <div id="quoteList" class="data-grid-body">
                                        <p class="text-gray-500 text-center py-4 col-span-full">No quotes added for this opportunity.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Events Section (Placeholder) -->
        <section id="events-section" class="container mx-auto p-6 hidden">
            <h2 class="section-title">Event Management</h2>
            <div class="card text-center py-12">
                <p class="text-gray-600 text-lg">Coming soon: Comprehensive event scheduling and management tools!</p>
            </div>
        </section>

        <!-- Admin - Country Mapping Section -->
        <section id="admin-country-mapping-section" class="container mx-auto p-6 hidden">
            <h2 class="section-title">Admin: Country & State/Province Mapping</h2>
            <div class="card mb-6">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Upload Country & State Data</h3>
                <form id="countryMappingForm">
                    <div class="mb-4">
                        <label for="adminCountriesInput" class="block text-sm font-medium text-gray-700 mb-1">
                            Countries (CSV: Name,Code - one per line)
                            <i id="loadCountriesIcon" class="fas fa-download text-blue-500 text-sm ml-2 cursor-pointer group relative">
                                <span class="tooltip-text">Click to load existing country data from Firestore into the textarea for editing.</span>
                            </i>
                        </label>
                        <textarea id="adminCountriesInput" rows="5" class="form-textarea" placeholder="United States,US&#10;Canada,CA&#10;Mexico,MX"></textarea>
                    </div>
                    <div class="mb-4">
                        <label for="adminCountryStateMapInput" class="block text-sm font-medium text-gray-700 mb-1">
                            Country-State/Province Map (CSV: Code:State1,State2 - one per line)
                            <i id="loadCountryStateMapIcon" class="fas fa-download text-blue-500 text-sm ml-2 cursor-pointer group relative">
                                <span class="tooltip-text">Click to load existing country-state map data from Firestore into the textarea for editing.</span>
                            </i>
                        </label>
                        <textarea id="adminCountryStateMapInput" rows="10" class="form-textarea" placeholder="US:AL,AK,AZ,AR,CA,CO,CT,DE,FL,GA,HI,ID,IL,IN,IA,KS,KY,LA,ME,MD,MA,MI,MN,MS,MO,MT,NE,NV,NH,NJ,NM,NY,NC,ND,OH,OK,OR,PA,RI,SC,SD,TN,TX,UT,VT,VA,WA,WV,WI,WY&#10;CA:AB,BC,MB,NB,NL,NS,ON,PE,QC,SK,NT,NU,YT"></textarea>
                    </div>
                    <div class="mb-4 flex items-center space-x-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="loadType" id="incrementalLoad" value="incremental" class="form-radio text-indigo-600 h-4 w-4" checked>
                            <span class="ml-2 text-gray-700 text-sm">Incremental Load (Merge existing data)</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="loadType" id="fullLoad" value="full" class="form-radio text-indigo-600 h-4 w-4">
                            <span class="ml-2 text-gray-700 text-sm">Full Load (Overwrite existing data)</span>
                        </label>
                    </div>
                    <div id="adminMessage" class="message hidden"></div>
                    <div class="flex justify-end mt-4">
                        <button type="submit" id="uploadAdminDataButton" class="btn-primary">Upload Data to Firestore</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Admin - Currency Management Section -->
        <section id="currency-management-section" class="container mx-auto p-6 hidden">
            <h2 class="section-title">Admin: Currency Management</h2>
            <div class="card mb-6">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4" id="currencyFormTitle">Add New Currency</h3>
                <form id="currencyForm">
                    <!-- Currency Code Display (hidden by default) -->
                    <div id="currencyCodeDisplayGroup" class="bg-gray-50 p-3 rounded-md text-sm text-gray-600 hidden mb-4">
                        <strong>Currency Code:</strong> <span id="currencyCodeDisplay"></span>
                    </div>

                    <div class="mb-4">
                        <label for="adminCurrenciesInput" class="block text-sm font-medium text-gray-700 mb-1">
                            Currencies (CSV: Code,Name,Symbol,Native_Symbol - one per line)
                            <i id="loadCurrenciesIcon" class="fas fa-download text-blue-500 text-sm ml-2 cursor-pointer group relative">
                                <span class="tooltip-text">Click to load all existing currencies from Firestore into the textarea for bulk editing.</span>
                            </i>
                        </label>
                        <textarea id="adminCurrenciesInput" rows="5" class="form-textarea" placeholder="USD,US Dollar,$,$&#10;EUR,Euro,€,€&#10;GBP,British Pound,£,£"></textarea>
                    </div>
                    <div id="adminCurrencyMessageDiv" class="message hidden"></div>
                    <div class="flex justify-end space-x-3 mt-4">
                        <button type="button" id="resetCurrencyFormButton" class="btn-secondary">Reset</button>
                        <button type="submit" id="submitCurrencyButton" class="btn-primary">Upload Currencies to Firestore</button>
                    </div>
                </form>
            </div>

            <h3 class="text-2xl font-semibold text-gray-800 mb-4">Existing Currencies</h3>
            <div class="card p-0 overflow-hidden">
                <div class="data-grid-header">
                    <div>Code</div>
                    <div>Name</div>
                    <div>Symbol</div>
                    <div>Native Symbol</div>
                    <div class="text-right">Actions</div>
                </div>
                <div id="currencyList" class="data-grid-body">
                    <p class="text-gray-500 text-center py-4 col-span-full">Loading currencies...</p>
                </div>
            </div>
        </section>

        <!-- Price Book Management Section -->
        <section id="price-book-management-section" class="hidden container mx-auto px-4 py-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Price Book Management</h2>

            <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                <h3 id="priceBookFormTitle" class="text-xl font-semibold text-gray-700 mb-4">Add New Price Book</h3>
                <form id="priceBookForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div id="priceBookIdDisplayGroup" class="mb-4 hidden">
                        <label for="priceBookIdDisplay" class="block text-sm font-medium text-gray-700">Price Book ID</label>
                        <input type="text" id="priceBookIdDisplay" readonly class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 bg-gray-100">
                    </div>

                    <div class="mb-4">
                        <label for="priceBookName" class="block text-sm font-medium text-gray-700">Price Book Name <span class="text-red-500">*</span></label>
                        <input type="text" id="priceBookName" required class="form-input">
                    </div>

                    <div class="mb-4">
                        <label for="priceBookCurrency" class="block text-sm font-medium text-gray-700">Currency <span class="text-red-500">*</span></label>
                        <select id="priceBookCurrency" required class="form-select">
                            <option value="">Select Currency</option>
                            <!-- Currencies will be populated by JavaScript -->
                        </select>
                    </div>

                    <div class="md:col-span-2 flex justify-end space-x-3">
                        <button type="submit" id="submitPriceBookButton" class="px-5 py-2 bg-blue-600 text-white font-semibold rounded-md shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition ease-in-out duration-150" disabled>
                            Add Price Book
                        </button>
                        <button type="button" id="resetPriceBookFormButton" class="px-5 py-2 bg-gray-300 text-gray-800 font-semibold rounded-md shadow hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-75 transition ease-in-out duration-150">
                            Reset Form
                        </button>
                    </div>
                </form>
                <div id="adminPriceBookMessageDiv" class="message hidden mt-4 p-3 rounded-md text-sm"></div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Existing Price Books</h3>
                <div class="data-grid">
                    <div class="data-grid-header">
                        <div class="px-2 py-1 font-bold text-gray-700">ID</div>
                        <div class="px-2 py-1 font-bold text-gray-700">Name</div>
                        <div class="px-2 py-1 font-bold text-gray-700">Currency</div>
                        <div class="px-2 py-1 font-bold text-gray-700 text-center">Actions</div>
                    </div>
                    <div id="priceBookList" class="data-grid-body">
                        <!-- Price Books will be loaded here by JavaScript -->
                        <p class="text-gray-500 text-center col-span-full py-4">No price books found.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin - User Management Section -->
        <section id="users-management-section" class="container mx-auto p-6 hidden">
            <h2 class="section-title">Admin: User Management</h2>
            <div class="card mb-6">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4" id="userFormTitle">Add New User Profile</h3>
                <form id="userForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- User ID Display / Input for New User -->
                    <div id="userIdDisplayInputGroup" class="md:col-span-2">
                        <label for="userIdDisplayInput" class="block text-sm font-medium text-gray-700 mb-1">
                            Firebase User ID (UID)
                            <i class="fas fa-info-circle text-gray-400 text-xs ml-1 group relative">
                                <span class="tooltip-text">For new users, enter their Firebase Authentication User ID (UID). For existing users, this field is read-only.</span>
                            </i>
                        </label>
                        <input type="text" id="userIdDisplayInput" class="form-input bg-gray-100" placeholder="e.g., 2P2j... (from Firebase Auth)" required>
                    </div>

                    <div>
                        <label for="userName" class="block text-sm font-medium text-gray-700 mb-1">User Name (Login Email)</label>
                        <input type="email" id="userName" class="form-input" placeholder="user@gmail.com" required>
                    </div>
                    <div>
                        <label for="userFirstName" class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                        <input type="text" id="userFirstName" class="form-input" placeholder="Jane" required>
                    </div>
                    <div>
                        <label for="userLastName" class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                        <input type="text" id="userLastName" class="form-input" placeholder="Doe" required>
                    </div>
                    <div>
                        <label for="userEmail" class="block text-sm font-medium text-gray-700 mb-1">Contact Email</label>
                        <input type="email" id="userEmail" class="form-input" placeholder="jane.doe@company.com" required>
                    </div>
                    <div>
                        <label for="userPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                        <input type="tel" id="userPhone" class="form-input" placeholder="(123) 456-7890" required>
                    </div>
                    <div>
                        <label for="userRole" class="block text-sm font-medium text-gray-700 mb-1">Role</label>
                        <select id="userRole" class="form-select" required>
                            <option value="User">User</option>
                            <option value="Admin">Admin</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label for="userSkills" class="block text-sm font-medium text-gray-700 mb-1">
                            Skills (Comma separated)
                            <i class="fas fa-info-circle text-gray-400 text-xs ml-1 group relative">
                                <span class="tooltip-text">Enter skills separated by commas, e.g., "Photography, Editing, Client Management".</span>
                            </i>
                        </label>
                        <textarea id="userSkills" rows="2" class="form-textarea" placeholder="Photography, Editing, Client Management" required></textarea>
                    </div>

                    <div class="md:col-span-2 flex justify-end space-x-3 mt-4">
                        <button type="button" id="resetUserFormButton" class="btn-secondary">Reset</button>
                        <button type="submit" id="submitUserButton" class="btn-primary">Create User Profile</button>
                    </div>
                </form>
            </div>

            <h3 class="text-2xl font-semibold text-gray-800 mb-4">Existing Users</h3>
            <div class="card p-0 overflow-hidden">
                <div class="data-grid-header">
                    <div>User ID</div>
                    <div>Login Email</div>
                    <div>Contact Email</div>
                    <div class="hidden sm:block">Role</div>
                    <div class="hidden md:block">Skills</div>
                    <div class="text-right">Actions</div>
                </div>
                <div id="userList" class="data-grid-body">
                    <p class="text-gray-500 text-center py-4 col-span-full">Loading users...</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white p-4 text-center mt-8">
        <div class="container mx-auto text-sm">
            &copy; <span id="currentYear"></span> ShutterSync CRM. All rights reserved.
        </div>
    </footer>

    <!-- Modal Container -->
    <div id="modalContainer"></div>

    <!-- Firebase Configuration and Main Script -->
    <script type="module" src="js/main.js"></script>

</body>
</html>
