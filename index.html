<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raffle Winner Announcement</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- Confetti library for celebration effect -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <style>
        /* Apply the Inter font globally and set a light background color */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* A soft, light blue-gray for the background */
            position: relative; /* Needed for absolute positioning of the watermark */
            min-height: 100vh; /* Ensure body takes full height for watermark to cover */
        }

        /* Watermark Overlay for the entire page */
        .watermark-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://www.villasinbangalore.co.in/wp-content/uploads/2016/04/Shriram-Chirping-Grove-Copy.jpg'); /* New image URL for homes watermark */
            background-repeat: no-repeat;
            background-position: center center;
            background-size: cover;
            opacity: 0.2; /* Increased opacity for more visibility */
            z-index: -1; /* Ensure it stays behind content */
        }

        /* Subtle diagonal stripes pattern for the main content box */
        .main-content-pattern {
            background-image: linear-gradient(45deg, #f0f4f8 25%, transparent 25%, transparent 75%, #f0f4f8 75%, #f0f4f8),
                              linear-gradient(45deg, #f0f4f8 25%, transparent 25%, transparent 75%, #f0f4f8 75%, #f0f4f8);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            opacity: 0.3; /* Adjust opacity for subtlety */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            border-radius: inherit;
        }

        /* Custom styles for button hover effects (Tailwind handles most, but adding a subtle scale) */
        .winner-button {
            transition: all 0.2s ease-in-out; /* Smooth transition for hover/active effects */
        }
        .winner-button:hover:not(:disabled) {
            transform: scale(1.05); /* Slightly enlarge button on hover, but not if disabled */
            box-shadow: 0 8px 15px rgba(0,0,0,0.2); /* More pronounced shadow on hover */
        }
        .winner-button:active:not(:disabled) {
            transform: scale(0.98); /* Slight press effect on click */
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); /* Reduced shadow on active */
        }

        /* Style for disabled buttons */
        .winner-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none; /* No shadow when disabled */
        }

        /* Style for the reset button */
        #reset-raffle-btn:hover {
            transform: scale(1.05);
        }

        /* Keyframes for a subtle pulsing animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Class to apply the pulsing animation */
        .pulsing-text {
            animation: pulse 1.5s infinite ease-in-out;
        }

        /* Post-it note styling for the Final Primary Winners section */
        .post-it-note {
            background-color: #fffacd; /* Light yellow, like a post-it */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(0, 0, 0, 0.05); /* Soft shadow for lift */
            transform: rotate(2deg); /* Slight rotation */
        }

        /* Inactive section styling */
        .inactive-section {
            opacity: 0.5;
            pointer-events: none; /* Prevents clicks on children */
            filter: grayscale(80%); /* Visually desaturate */
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-10 px-4">
    <!-- Watermark Overlay Div for the entire page -->
    <div class="watermark-overlay"></div>

    <div class="bg-white p-6 md:p-10 rounded-xl shadow-2xl max-w-4xl w-full text-center relative z-0">
        <!-- Subtle pattern for the main content box -->
        <div class="main-content-pattern"></div>

        <div class="mb-8 relative z-10"> <!-- Z-index to ensure content is above pattern -->
            <div class="flex items-center justify-center md:justify-start mb-4">
                <div class="w-20 h-20 md:w-24 md:h-24 mr-4 md:mr-6 flex-shrink-0">
                    <img src="https://static.wixstatic.com/media/df2113_f71b21a1906c4d2bace3f797f5a6a8bb~mv2.png/v1/crop/x_5,y_0,w_365,h_315/fill/w_87,h_75,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/LogoDesign-II%20(1)_edited.png"
                         alt="St. Sebastian's Church Logo"
                         class="w-full h-full object-contain rounded-full">
                </div>
                <h1 class="text-3xl md:text-4xl font-extrabold text-indigo-800 text-left">
                    St. Sebastian's Church Raffle Winner Announcement
                </h1>
            </div>
            <div class="text-gray-600 text-sm md:text-base mb-8 text-left md:ml-28">
                <p>No:184/C, New Byppanahalli Extn, Indiranagar, Bengaluru â€“ 560038</p>
                <p>+91 7090424365 | stsebastianssmc@gmail.com</p>
            </div>
        </div>

        <p class="text-lg text-gray-700 mb-10 relative z-10">
            Congratulations to all our lucky winners! Thank you for participating in our church raffle.
            Click the "Generate Winners" button for each place to reveal the winning ticket numbers.
            <strong class="text-red-600">1st Place winners are drawn from 'winners.txt'. 2nd and 3rd Place winners are drawn from 'winners1.txt'. Each ticket can only win once!</strong>
        </p>

        <div id="status-message" class="text-center text-lg font-semibold text-gray-600 mb-6 relative z-10">
            Loading ticket data...
        </div>

        <div id="first-place-section" class="winner-section bg-gradient-to-br from-yellow-400 to-yellow-600 p-6 rounded-lg shadow-lg mb-8 relative z-10">
            <h2 class="text-3xl font-bold text-white mb-6 flex items-center justify-center">
                <span class="mr-3 text-4xl">ðŸ¥‡</span> 1st Place Winners
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="winner-card bg-yellow-100 p-4 rounded-md shadow-md">
                    <h3 class="text-xl font-semibold text-yellow-800">Primary Winner</h3>
                    <p id="first-primary" class="text-3xl font-bold text-yellow-900 mt-2">---</p>
                </div>
                <div class="winner-card bg-yellow-100 p-4 rounded-md shadow-md">
                    <h3 class="text-xl font-semibold text-yellow-800">Secondary Winner</h3>
                    <p id="first-secondary" class="text-3xl font-bold text-yellow-900 mt-2">---</p>
                </div>
                <div class="winner-card bg-yellow-100 p-4 rounded-md shadow-md">
                    <h3 class="text-xl font-semibold text-yellow-800">Third Winner</h3>
                    <p id="first-third" class="text-3xl font-bold text-yellow-900 mt-2">---</p>
                </div>
            </div>
            <button id="generate-first" class="winner-button px-8 py-3 bg-yellow-700 text-white font-semibold rounded-full shadow-lg hover:bg-yellow-800 transition duration-300 ease-in-out" disabled>
                Generate 1st Place Winners
            </button>
        </div>

        <div id="second-place-section" class="winner-section bg-gradient-to-br from-gray-400 to-gray-600 p-6 rounded-lg shadow-lg mb-8 relative z-10 inactive-section">
            <h2 class="text-3xl font-bold text-white mb-6 flex items-center justify-center">
                <span class="mr-3 text-4xl">ðŸ¥ˆ</span> 2nd Place Winners
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="winner-card bg-gray-100 p-4 rounded-md shadow-md">
                    <h3 class="text-xl font-semibold text-gray-800">Primary Winner</h3>
                    <p id="second-primary" class="text-3xl font-bold text-gray-900 mt-2">---</p>
                </div>
                <div class="winner-card bg-gray-100 p-4 rounded-md shadow-md">
                    <h3 class="text-xl font-semibold text-gray-800">Secondary Winner</h3>
                    <p id="second-secondary" class="text-3xl font-bold text-gray-900 mt-2">---</p>
                </div>
                <div class="winner-card bg-gray-100 p-4 rounded-md shadow-md">
                    <h3 class="text-xl font-semibold text-gray-800">Third Winner</h3>
                    <p id="second-third" class="text-3xl font-bold text-gray-900 mt-2">---</p>
                </div>
            </div>
            <button id="generate-second" class="winner-button px-8 py-3 bg-gray-700 text-white font-semibold rounded-full shadow-lg hover:bg-gray-800 transition duration-300 ease-in-out" disabled>
                Generate 2nd Place Winners
            </button>
        </div>

        <div id="third-place-section" class="winner-section bg-gradient-to-br from-amber-600 to-amber-800 p-6 rounded-lg shadow-lg relative z-10 inactive-section">
            <h2 class="text-3xl font-bold text-white mb-6 flex items-center justify-center">
                <span class="mr-3 text-4xl">ðŸ¥‰</span> 3rd Place Winners
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="winner-card bg-amber-100 p-4 rounded-md shadow-md">
                    <h3 class="text-xl font-semibold text-amber-800">Primary Winner</h3>
                    <p id="third-primary" class="text-3xl font-bold text-amber-900 mt-2">---</p>
                </div>
                <div class="winner-card bg-amber-100 p-4 rounded-md shadow-md">
                    <h3 class="text-xl font-semibold text-amber-800">Secondary Winner</h3>
                    <p id="third-secondary" class="text-3xl font-bold text-amber-900 mt-2">---</p>
                </div>
                <div class="winner-card bg-amber-100 p-4 rounded-md shadow-md">
                    <h3 class="text-xl font-semibold text-amber-800">Third Winner</h3>
                    <p id="third-third" class="text-3xl font-bold text-amber-900 mt-2">---</p>
                </div>
            </div>
            <button id="generate-third" class="winner-button px-8 py-3 bg-amber-900 text-white font-semibold rounded-full shadow-lg hover:bg-amber-950 transition duration-300 ease-in-out" disabled>
                Generate 3rd Place Winners
            </button>
        </div>

        <button id="reset-raffle-btn" class="mt-10 px-8 py-3 bg-red-600 text-white font-semibold rounded-full shadow-lg hover:bg-red-700 transition duration-300 ease-in-out">
            Reset Raffle
        </button>
    </div>

    <!-- Final Primary Winners section - now with post-it styling -->
    <div class="fixed top-1/2 right-4 -translate-y-1/2 w-72 p-6 rounded-lg shadow-md z-50 hidden lg:block post-it-note">
        <h2 class="text-2xl font-bold text-green-800 mb-4">Final Primary Winners</h2>
        <div class="grid grid-cols-1 gap-4">
            <div class="winner-card bg-white p-4 rounded-md shadow-sm">
                <h3 class="text-xl font-semibold text-green-700">1st Place Primary</h3>
                <p class="final-primary-winner-display" id="final-first-primary-desktop">---</p>
            </div>
            <div class="winner-card bg-white p-4 rounded-md shadow-sm">
                <h3 class="text-xl font-semibold text-green-700">2nd Place Primary</h3>
                <p class="final-primary-winner-display" id="final-second-primary-desktop">---</p>
            </div>
            <div class="winner-card bg-white p-4 rounded-md shadow-sm">
                <h3 class="text-xl font-semibold text-green-700">3rd Place Primary</h3>
                <p class="final-primary-winner-display" id="final-third-primary-desktop">---</p>
            </div>
        </div>
    </div>

    <!-- Footer Section -->
    <footer class="w-full bg-gray-800 text-gray-300 text-center py-4 mt-10 text-sm relative z-10">
        <p>&copy; 2023 St. Sebastian's Church. All rights reserved.</p>
        <p>Powered by <a href="#" class="text-blue-400 hover:underline">DataWings Solution</a></p>
    </footer>

    <script>
        let raffleTicketsWinners = []; // Will be populated from winners.txt
        let raffleTicketsWinners1 = []; // Will be populated from winners1.txt
        let allTimePickedTickets = new Set(); // Global set to store all tickets ever picked

        const statusMessageElement = document.getElementById('status-message');
        const generateButtons = document.querySelectorAll('.winner-button');
        const resetRaffleBtn = document.getElementById('reset-raffle-btn');

        // Get references to the winner sections
        const firstPlaceSection = document.getElementById('first-place-section');
        const secondPlaceSection = document.getElementById('second-place-section');
        const thirdPlaceSection = document.getElementById('third-place-section');

        // Get references to the "Generate Winners" buttons for each place
        const generateFirstBtn = document.getElementById('generate-first');
        const generateSecondBtn = document.getElementById('generate-second');
        const generateThirdBtn = document.getElementById('generate-third');

        /**
         * Utility function to introduce a delay.
         * @param {number} ms - The delay in milliseconds.
         */
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        /**
         * Disables all "Generate Winners" buttons.
         */
        function disableAllGenerateButtons() {
            generateButtons.forEach(button => button.disabled = true);
        }

        /**
         * Enables the specified section and its button, and disables others.
         * @param {HTMLElement} sectionElement - The section element to activate.
         * @param {HTMLButtonElement} buttonElement - The button element to enable.
         */
        function activateSection(sectionElement, buttonElement) {
            // Deactivate all sections first
            [firstPlaceSection, secondPlaceSection, thirdPlaceSection].forEach(section => {
                section.classList.add('inactive-section');
            });
            disableAllGenerateButtons();

            // Activate the target section and its button
            sectionElement.classList.remove('inactive-section');
            buttonElement.disabled = false;
        }

        /**
         * Resets the displayed winner numbers to "---".
         */
        function clearDisplayedWinners() {
            document.getElementById('first-primary').textContent = '---';
            document.getElementById('first-secondary').textContent = '---';
            document.getElementById('first-third').textContent = '---';
            document.getElementById('second-primary').textContent = '---';
            document.getElementById('second-secondary').textContent = '---';
            document.getElementById('second-third').textContent = '---';
            document.getElementById('third-primary').textContent = '---';
            document.getElementById('third-secondary').textContent = '---';
            document.getElementById('third-third').textContent = '---';

            // Also clear the final winners sections
            document.getElementById('final-first-primary-desktop').textContent = '---';
            document.getElementById('final-second-primary-desktop').textContent = '---';
            document.getElementById('final-third-primary-desktop').textContent = '---';
        }

        /**
         * Fetches ticket numbers from a text file and parses them into an array of strings.
         * Expects alphanumeric strings to be separated by newlines or commas.
         * @param {string} filePath - The path to the text file.
         * @returns {Promise<Array<string>>} A promise that resolves with an array of alphanumeric strings.
         */
        async function fetchTicketNumbers(filePath) {
            try {
                const fullUrl = new URL(filePath, window.location.href).href;
                console.log(`Attempting to fetch from: ${fullUrl}`);

                const response = await fetch(fullUrl);
                if (!response.ok) {
                    throw new Error(`Failed to load ${filePath} (HTTP status: ${response.status}): ${response.statusText}`);
                }
                const text = await response.text();
                console.log(`Raw content of ${filePath}:`, text);

                // Split by newline or comma, filter out empty strings, and trim whitespace.
                const tickets = text.split(/[\n,]+/)
                                   .map(s => s.trim())
                                   .filter(s => s !== '');

                console.log(`Parsed tickets from ${filePath}:`, tickets);
                return tickets;
            } catch (error) {
                console.error(`Error fetching ${filePath}:`, error);
                statusMessageElement.textContent = `Error loading ticket data from '${filePath}'. Please ensure the file exists in the same directory as your HTML, contains valid alphanumeric tickets (one per line or comma-separated), and is correctly formatted. It might also be a security restriction in this preview environment.`;
                disableAllGenerateButtons();
                throw error;
            }
        }

        /**
         * Initializes the application by fetching ticket data from external files.
         */
        async function initializeRaffleData() {
            statusMessageElement.textContent = "Loading ticket data...";
            disableAllGenerateButtons();
            clearDisplayedWinners(); // Clear any previous winners on load

            try {
                const [winnersData, winners1Data] = await Promise.all([
                    fetchTicketNumbers('winners.txt'),
                    fetchTicketNumbers('winners1.txt')
                ]);

                raffleTicketsWinners = winnersData;
                raffleTicketsWinners1 = winners1Data;

                // Check if the loaded arrays have enough unique tickets for picking
                if (raffleTicketsWinners.length < 3 || raffleTicketsWinners1.length < 6) {
                    statusMessageElement.textContent = `Error: Not enough unique ticket numbers available. 'winners.txt' has ${raffleTicketsWinners.length} tickets (needs at least 3 for 1st place). 'winners1.txt' has ${raffleTicketsWinners1.length} tickets (needs at least 6 for 2nd and 3rd place). Please populate your files with more unique alphanumeric tickets.`;
                    disableAllGenerateButtons();
                    return;
                }

                statusMessageElement.textContent = "Ticket data loaded successfully! Click 'Generate 1st Place Winners' to begin.";
                // Initially activate only the first place section
                activateSection(firstPlaceSection, generateFirstBtn);

            } catch (error) {
                // Error handled in fetchTicketNumbers, just ensure buttons are disabled
                disableAllGenerateButtons();
            }
        }

        /**
         * Generates a random integer between min (inclusive) and max (inclusive).
         * This function is a helper to pick a random index from an array.
         * @param {number} min - The minimum value for the random number (usually 0 for array index).
         * @param {number} max - The maximum value for the random number (usually array.length - 1).
         * @returns {number} A random integer within the specified range.
         */
        function getRandomNumber(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        /**
         * Generates a random alphanumeric string in the format "AAA12345678".
         * @returns {string} A random alphanumeric string.
         */
        function generateRandomAlphanumeric() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            let result = '';
            for (let i = 0; i < 3; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            for (let i = 0; i < 8; i++) {
                result += Math.floor(Math.random() * 10);
            }
            return result;
        }

        /**
         * Picks a single unique random element from a source array, ensuring it's not
         * already present in a set of 'currentDrawAvoidTickets' (for uniqueness within this draw)
         * AND 'allTimePickedTickets' (for overall uniqueness).
         * @param {Array<string>} sourceArray - The array of alphanumeric tickets to pick from.
         * @param {Set<string>} currentDrawAvoidTickets - A Set containing tickets that have already been picked
         * for the current prize category (Primary, Secondary, Third for one place) during this single button click.
         * @returns {string} A unique random alphanumeric ticket, or "N/A" if no unique ticket can be found.
         */
        function pickSingleUniqueTicket(sourceArray, currentDrawAvoidTickets) {
            // Filter out tickets that are already in the global set OR the current draw's local set
            const availableTickets = sourceArray.filter(ticket =>
                !allTimePickedTickets.has(ticket) && !currentDrawAvoidTickets.has(ticket)
            );

            if (availableTickets.length === 0) {
                console.warn("Not enough unique tickets available in the source pool for this pick, considering all previously picked tickets.");
                return "N/A"; // Return "N/A" if no unique ticket can be found
            }

            // Pick a random index from the available tickets
            const randomIndex = getRandomNumber(0, availableTickets.length - 1);
            const pickedTicket = availableTickets[randomIndex];

            // Add to the local set for this draw's uniqueness
            currentDrawAvoidTickets.add(pickedTicket);
            // Add to the global set for all-time uniqueness
            allTimePickedTickets.add(pickedTicket);

            return pickedTicket;
        }

        /**
         * Triggers a confetti animation from the top center of the screen.
         */
        function triggerConfetti() {
            confetti({
                particleCount: 150, /* Increased particle count */
                spread: 90, /* Wider spread */
                origin: { y: 0.6 },
                colors: ['#FFD700', '#C0C0C0', '#CD7F32', '#FFFFFF', '#FF69B4'] /* Gold, Silver, Bronze, White, Pink */
            });
        }

        /**
         * Animates a number reveal effect on a given element.
         * @param {HTMLElement} element - The HTML element to animate.
         * @param {string} finalNumber - The final number to display.
         */
        async function animateNumberReveal(element, finalNumber) {
            const duration = 1000; // 1 second for animation
            const startTime = Date.now();
            const interval = 50; // Update every 50ms

            element.classList.add('pulsing-text'); // Start pulsing animation

            const animationInterval = setInterval(() => {
                const elapsed = Date.now() - startTime;
                if (elapsed < duration) {
                    // Generate a random alphanumeric string for the animation
                    element.textContent = generateRandomAlphanumeric();
                } else {
                    clearInterval(animationInterval);
                    element.textContent = finalNumber;
                    element.classList.remove('pulsing-text'); // Stop pulsing animation
                    // Trigger confetti after each number is revealed
                    triggerConfetti();
                }
            }, interval);
        }

        /**
         * Updates the display elements for a specific place's winners (Primary, Secondary, Third).
         * It now picks winners based on the specified file source for each place.
         * @param {string} placePrefix - The prefix for the winner IDs (e.g., 'first', 'second', 'third').
         * This helps in targeting the correct HTML elements.
         */
        async function updateWinnersDisplay(placePrefix) {
            // Get references to the specific HTML elements where the winners will be displayed
            const primaryElement = document.getElementById(`${placePrefix}-primary`);
            const secondaryElement = document.getElementById(`${placePrefix}-secondary`);
            const thirdElement = document.getElementById(`${placePrefix}-third`);

            // Get references to the final winner display elements
            const finalPrimaryDesktop = document.getElementById(`final-${placePrefix}-primary-desktop`);

            disableAllGenerateButtons(); // Disable all buttons during generation process
            statusMessageElement.textContent = "Drawing winners..."; // Updated loading message

            // Create a Set to keep track of tickets picked for the current place (Primary, Secondary, Third)
            // to ensure all three are unique from each other within this specific draw.
            const pickedTicketsForThisPlace = new Set();
            let sourceArrayForPlace;

            // Determine the source array based on the prize place
            if (placePrefix === 'first') {
                sourceArrayForPlace = raffleTicketsWinners;
            } else if (placePrefix === 'second' || placePrefix === 'third') {
                sourceArrayForPlace = raffleTicketsWinners1;
            } else {
                console.error("Invalid place prefix provided:", placePrefix);
                // Re-enable only the current section's button on error
                if (placePrefix === 'first') generateFirstBtn.disabled = false;
                if (placePrefix === 'second') generateSecondBtn.disabled = false;
                if (placePrefix === 'third') generateThirdBtn.disabled = false;
                statusMessageElement.textContent = "Error: Invalid prize category.";
                return; // Exit if invalid prefix
            }

            // Pick winners from the determined source array
            const primaryWinner = pickSingleUniqueTicket(sourceArrayForPlace, pickedTicketsForThisPlace);
            const secondaryWinner = pickSingleUniqueTicket(sourceArrayForPlace, pickedTicketsForThisPlace);
            const thirdWinner = pickSingleUniqueTicket(sourceArrayForPlace, pickedTicketsForThisPlace);

            // Animate and display each winner sequentially
            await animateNumberReveal(primaryElement, primaryWinner);
            await delay(500); // Small delay between each winner reveal
            await animateNumberReveal(secondaryElement, secondaryWinner);
            await delay(500);
            await animateNumberReveal(thirdElement, thirdWinner);

            // Update the final primary winner display
            if (finalPrimaryDesktop) {
                finalPrimaryDesktop.textContent = primaryWinner;
            }

            // Disable the button for the current section after its winners are generated
            if (placePrefix === 'first') {
                generateFirstBtn.disabled = true;
            } else if (placePrefix === 'second') {
                generateSecondBtn.disabled = true;
            } else if (placePrefix === 'third') {
                generateThirdBtn.disabled = true;
            }

            statusMessageElement.textContent = "Winners revealed! Click another button or reset the raffle.";

            // Activate the next section in sequence
            if (placePrefix === 'first') {
                activateSection(secondPlaceSection, generateSecondBtn);
            } else if (placePrefix === 'second') {
                activateSection(thirdPlaceSection, generateThirdBtn);
            } else if (placePrefix === 'third') {
                // If all winners are drawn, disable all buttons (which is already done by disableAllGenerateButtons)
                // and just update the status message. The current button (generateThirdBtn) is already disabled above.
                statusMessageElement.textContent = "All unique tickets have been drawn! Reset raffle to start again.";
            }

            // Optional: Check if all possible tickets have been drawn and disable buttons if so
            const totalTicketsInWinners = new Set(raffleTicketsWinners).size;
            const totalTicketsInWinners1 = new Set(raffleTicketsWinners1).size;
            const overallTotalUniqueTickets = new Set([...raffleTicketsWinners, ...raffleTicketsWinners1]).size;

            if (allTimePickedTickets.size >= overallTotalUniqueTickets) {
                statusMessageElement.textContent = "All unique tickets have been drawn from both pools! Reset raffle to start again.";
                disableAllGenerateButtons();
            }
        }

        // Add event listeners to each button.
        // When a button is clicked, it calls `updateWinnersDisplay` with the appropriate prefix.
        generateFirstBtn.addEventListener('click', () => updateWinnersDisplay('first'));
        generateSecondBtn.addEventListener('click', () => updateWinnersDisplay('second'));
        generateThirdBtn.addEventListener('click', () => updateWinnersDisplay('third'));

        // Add event listener for the Reset Raffle button
        if (resetRaffleBtn) {
            resetRaffleBtn.addEventListener('click', () => {
                allTimePickedTickets.clear(); // Clear all previously picked tickets
                clearDisplayedWinners(); // Reset displayed text
                initializeRaffleData(); // Re-initialize data and set initial active section
                statusMessageElement.textContent = "Raffle reset. Ticket data reloaded. Click 'Generate 1st Place Winners' to begin.";
            });
        }

        // Initialize data when the page loads
        document.addEventListener('DOMContentLoaded', initializeRaffleData);
    </script>
</body>
</html>
